[{"id":"5e27b596.12bbbc","type":"tab","label":"Timers","disabled":false,"info":"This page is basic backup timers used in case I fuck up the actual WAKE UP page."},{"id":"5469bf4.95d0d4","type":"tab","label":"WAKE UP","disabled":false,"info":""},{"id":"eac2df63.5cf68","type":"tab","label":"Smart Car","disabled":false,"info":"Translates openEVSE mqtt statuses into something I can understand."},{"id":"25056595.dda88a","type":"tab","label":"Garage doors","disabled":false,"info":""},{"id":"a13f7cde.5004","type":"tab","label":"Garage alexa","disabled":false,"info":""},{"id":"db2a1cbe.45656","type":"tab","label":"Garage AC","disabled":true,"info":""},{"id":"e9c46f27.b8a08","type":"tab","label":"Litterbox","disabled":false,"info":""},{"id":"eff727ba.42a3a8","type":"tab","label":"To Alexa(s)","disabled":false,"info":""},{"id":"215b943e.474c3c","type":"tab","label":"To Email","disabled":false,"info":""},{"id":"838b375b.a3fcd8","type":"tab","label":"Laundry","disabled":false,"info":""},{"id":"81799776.d66798","type":"tab","label":"Telegram notifications","disabled":false,"info":""},{"id":"8b414f68.37d25","type":"tab","label":"Condition Tests","disabled":false,"info":""},{"id":"2b590643.985dca","type":"tab","label":"3D printing","disabled":false,"info":""},{"id":"73b5a3a7.e7bf5c","type":"tab","label":"Following lights","disabled":false,"info":""},{"id":"b7987fdf.32542","type":"tab","label":"Alarm notifications","disabled":false,"info":""},{"id":"235eedcf.c34822","type":"tab","label":"Mailbox announce","disabled":false,"info":""},{"id":"84e379b8.2c3a08","type":"tab","label":"Browser mod","disabled":false,"info":""},{"id":"e1506c1e.a4be5","type":"tab","label":"Flow 1","disabled":true,"info":""},{"id":"be3e73a2.2f6e6","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"cf48887c.47edf8","type":"tab","label":"Thermostat","disabled":true,"info":""},{"id":"edb1bef3.011b5","type":"subflow","name":"simpletime","info":"This lightweight sub-flow produces a Date/Time output in different formats for use in node-red flows.  \r\nThe sub-flow creates a `simpletime` node which can be inserted in any running flow, and adds the following messages to the flow; \r\n\r\n* msg.myrawdate: \"2017-11-08T20:36:26.257Z\"\r\n* msg.myepoch: 1510173386257\r\n* msg.mydate: \"Wed Nov 08 2017\"\r\n* msg.myhour: \"20\"\r\n* msg.myminute: \"36\"\r\n* msg.myminutes: \"36:26\"\r\n* msg.mysecond: \"26\"\r\n* msg.mytime: \"20:36\"\r\n* msg.mytimes: \"20:36:26\"\r\n\r\nAll other messages such as msg.payload & topic pass straight through the node unhindered.\r\n\r\nTo introduce any of the messages into a flow, simply assign any, or any combination of the messages into a variable(s), such as; `var seconds = msg.myseconds;`  \r\nor to use in a ui_text node add via mustache `{{msg.mytimes}}` \r\n\r\nFor advanced functionality, I would strongly recommend using the node-red-contrib-moment which is better equipped to handle edge-cases.\r\n\r\nAny feedback - please give me a shout - @rossoreed on [node-red slack](https://nodered.org/slack)","category":"","in":[{"x":174,"y":108,"wires":[{"id":"94c47153.07e68"}]}],"out":[{"x":488,"y":108,"wires":[{"id":"94c47153.07e68","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"cc5ab19e.7bb6f","type":"subflow","name":"Say on Phone","info":"This takes any text and says it on the OnePlus5 via MQTT.","category":"","in":[{"x":20,"y":80,"wires":[{"id":"e042f7c.11d4108"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"ecafd5c5.2d8028","type":"subflow","name":"Office Alexa TTS","info":"","category":"","in":[{"x":0,"y":80,"wires":[{"id":"723af41d.14c3fc"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"2ab0d9fb.322536","type":"subflow","name":"Kitchen Alexa TTS","info":"","category":"","in":[{"x":0,"y":80,"wires":[{"id":"4b6861e.484afa"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"ed60b07d.9ec52","type":"subflow","name":"Garage Alexa TTS","info":"","category":"","in":[{"x":0,"y":80,"wires":[{"id":"f65d3ff4.1b76f"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"cba02be5.02efe8","type":"subflow","name":"All Alexi TTS","info":"This takes raw text and converts it to the right format to be spoken on ALL Alexa devices.","category":"","in":[{"x":0,"y":140,"wires":[{"id":"c2e90443.bfba38"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"a2de79f8.d4c028","type":"subflow","name":"Email me","info":"","category":"","in":[{"x":60,"y":80,"wires":[{"id":"acf5381d.6f21a8"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"bdd4ada0.860a7","type":"subflow","name":"Close shop door","info":"Closes the shop overhead door and creates TTS for Alexa and phone.","category":"","in":[{"x":40,"y":80,"wires":[{"id":"c60ef154.2d8b4"}]}],"out":[{"x":780,"y":140,"wires":[{"id":"98c84c21.d3bbf","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"8092f866.de7468","type":"subflow","name":"Close Truck door","info":"This closes the truck door and generates TTS for Alexa and phone.","category":"","in":[{"x":40,"y":80,"wires":[{"id":"97efc010.6d9ea"}]}],"out":[{"x":900,"y":100,"wires":[{"id":"129a2d87.51ec72","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"f8a41b81.9486e8","type":"subflow","name":"Var Last Motion","info":"Reads motion sensor inputs from:\n- Office\n- Doorbell\n- Garage\n- Kitchen\n- Living Room\n- Workbench\n\nand reports the friendly name as the var.last_alarm value.","category":"","in":[],"out":[{"x":760,"y":240,"wires":[{"id":"d789f01c.07e0c","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"90f9a58f.0b08e8","type":"subflow","name":"Alarm Windows","info":"All alarm system window contacts.  Outputs binary_sensor.whatwastriggered","category":"","in":[],"out":[{"x":1060,"y":500,"wires":[{"id":"75122ef3.ea0b1","port":0},{"id":"d981d8be.083038","port":0},{"id":"3b9dc1f7.a3d74e","port":0},{"id":"3d78ec8c.982984","port":0},{"id":"ee033dd1.de246","port":0},{"id":"b51b2cc1.5658f","port":0},{"id":"1d0ddc8d.0eb293","port":0},{"id":"fd8af785.0b4518","port":0},{"id":"b2151e92.e937c","port":0},{"id":"76dcd5a2.ad82bc","port":0},{"id":"70452f64.51adf","port":0},{"id":"b779639c.e767c","port":0},{"id":"58e7ac65.6b60d4","port":0},{"id":"b2548327.c481d","port":0},{"id":"a725c89b.85ff88","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"fe2f3ca8.f94af","type":"subflow","name":"Alarm Doors","info":"All alarm system Door contacts.  Outputs binary_sensor.whatwastriggered","category":"","in":[],"out":[{"x":960,"y":320,"wires":[{"id":"643e4171.62a4a","port":0},{"id":"4837509.877aab","port":0},{"id":"f6c7dedc.4a321","port":0},{"id":"6981e5a9.12c35c","port":0},{"id":"17d15ccd.68ae63","port":0},{"id":"12dd0944.1f0917","port":0},{"id":"138de9f2.c9ae56","port":0},{"id":"79085489.e2eb8c","port":0},{"id":"6f59caf4.e1bde4","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"8ff98bb0.b2c218","type":"subflow","name":"Alarm motions","info":"All motion detectors from alarm system.","category":"","in":[],"out":[{"x":440,"y":100,"wires":[{"id":"10b7ca3b.001876","port":0},{"id":"d27a0f61.a01e6","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"7381bffb.6559f","type":"subflow","name":"Alarm Accessories","info":"Non-critical alarm sensors","category":"","in":[],"out":[{"x":740,"y":260,"wires":[{"id":"88f81979.c7db58","port":0},{"id":"3634489.27692b8","port":0},{"id":"37332e64.1e7cb2","port":0},{"id":"83ed308.43575d","port":0},{"id":"71c355b4.3a208c","port":0},{"id":"ab3b14c6.e3a9f8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"b47b41ce.34bdf","type":"subflow","name":"Var Last Alarm","info":"","category":"","in":[],"out":[{"x":800,"y":160,"wires":[{"id":"e716a167.b5ae7","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"a7b0f219.2da23","type":"subflow","name":"Var Last Vehicle","info":"","category":"","in":[],"out":[{"x":900,"y":120,"wires":[{"id":"788c304.de25fd","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"9afb58a1.205718","type":"mqtt-broker","z":"","name":"J Local","broker":"192.168.0.20","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"29d635fb.a91c9a","type":"server","z":"","name":"J Home Assistant","legacy":false,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true},{"id":"7496d390.0337bc","type":"alexa-home-conf","z":"","username":"jakekooser"},{"id":"f0f3ea5.90dd918","type":"chatbot-telegram-node","z":"","botname":"@Jakeshomebot","usernames":"378256983","providerToken":"","polling":"10000","store":"","log":"/home/docker/logs/telegram.log","parseMode":"HTML","debug":false,"webHook":"","connectMode":"polling"},{"id":"60236f0c.f6d7f","type":"influxdb","z":"","hostname":"192.168.0.20","port":"8086","protocol":"http","database":"homeassistant","name":"Homeassistant","usetls":false,"tls":""},{"id":"7a4143e7.502d3c","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"1e13b209.c513de","type":"mqtt in","z":"eac2df63.5cf68","name":"openevse/state","topic":"openevse/state","qos":"2","datatype":"auto","broker":"9afb58a1.205718","x":160,"y":100,"wires":[["d33a3ffa.b6311"]]},{"id":"f904613a.b4419","type":"change","z":"eac2df63.5cf68","name":"Status Payload","rules":[{"t":"change","p":"payload","pt":"msg","from":"disconnected","fromt":"num","to":"Car NOT Connected","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"connected","fromt":"num","to":"Car is Connected","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"charging","fromt":"num","to":"Car is Charging","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":100,"wires":[["d77afc61.033ec"]]},{"id":"d77afc61.033ec","type":"mqtt out","z":"eac2df63.5cf68","name":"car/status","topic":"car/status","qos":"2","retain":"","broker":"9afb58a1.205718","x":790,"y":100,"wires":[]},{"id":"d33a3ffa.b6311","type":"state-machine","z":"eac2df63.5cf68","name":"Car Charging Status","triggerProperty":"payload","triggerPropertyType":"msg","stateProperty":"payload","statePropertyType":"msg","outputStateChangeOnly":true,"throwException":false,"states":["disconnected","charging","connected"],"transitions":[{"name":"3","from":"disconnected","to":"charging"},{"name":"2","from":"charging","to":"connected"},{"name":"1","from":"connected","to":"disconnected"},{"name":"2","from":"disconnected","to":"connected"},{"name":"1","from":"charging","to":"disconnected"},{"name":"3","from":"connected","to":"charging"}],"x":390,"y":100,"wires":[["f904613a.b4419"]]},{"id":"45958c84.650484","type":"mqtt in","z":"eac2df63.5cf68","name":"openevse/amp","topic":"openevse/amp","qos":"2","datatype":"auto","broker":"9afb58a1.205718","x":160,"y":240,"wires":[["4b99ebd7.cd7914"]]},{"id":"e580bee6.790cf","type":"debug","z":"eac2df63.5cf68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","x":910,"y":240,"wires":[]},{"id":"4b99ebd7.cd7914","type":"function","z":"eac2df63.5cf68","name":"divide amps by 1000","func":"\nmsg.payload = Number(msg.payload);\nmsg.payload = (msg.payload)/1000;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":240,"wires":[["e580bee6.790cf","4c8abbc5.dae914"]]},{"id":"4c8abbc5.dae914","type":"mqtt out","z":"eac2df63.5cf68","name":"Charging amps","topic":"car/charging_amps","qos":"1","retain":"","broker":"9afb58a1.205718","x":700,"y":240,"wires":[]},{"id":"173f4d65.b1a263","type":"inject","z":"e1506c1e.a4be5","name":"Every day at noon","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 12 * * *","once":false,"onceDelay":0.1,"x":210,"y":960,"wires":[["45f8f8e8.47ea88"]]},{"id":"45f8f8e8.47ea88","type":"http request","z":"e1506c1e.a4be5","name":"Get sunup / sundown WUG","method":"GET","ret":"obj","url":"http://api.wunderground.com/api/c7f34e637fc21578/astronomy/q/pws:KFLHOLLY61.json","tls":"","x":340,"y":1020,"wires":[["25e259a0.7ebc76"]]},{"id":"155b7e90.246971","type":"debug","z":"e1506c1e.a4be5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":630,"y":960,"wires":[]},{"id":"ff6b1d5f.91fba","type":"comment","z":"e1506c1e.a4be5","name":"How to pull data and see what it is","info":"","x":280,"y":900,"wires":[]},{"id":"25e259a0.7ebc76","type":"function","z":"e1506c1e.a4be5","name":"","func":"srise = (\"0\"+msg.payload.sun_phase.sunrise.hour).slice(-2) + ':' + (\"0\"+msg.payload.sun_phase.sunrise.minute).slice(-2);\nsset = (\"0\"+msg.payload.sun_phase.sunset.hour).slice(-2) + ':' + (\"0\"+msg.payload.sun_phase.sunset.minute).slice(-2);\nreturn { sunrise : srise, sunset : sset };\n","outputs":1,"noerr":0,"x":470,"y":960,"wires":[["155b7e90.246971"]]},{"id":"3b163dc4.031252","type":"switch","z":"cf48887c.47edf8","name":"Air/Heat","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Air","vt":"str"},{"t":"eq","v":"Heat","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":80,"y":320,"wires":[["594ad69a.2ff738","4a3ead90.c7b984"],[]]},{"id":"c8ba7dac.d3728","type":"trigger-state","z":"cf48887c.47edf8","name":"Off","server":"29d635fb.a91c9a","entityid":"input_select.thermostat_upstairs","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"o3re3hu1igr","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Off"},{"id":"29m7nyzl98b","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"Off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":70,"y":80,"wires":[["fbae9610.09b098","d8dadbd7.c378d8"],[]]},{"id":"fbae9610.09b098","type":"api-call-service","z":"cf48887c.47edf8","name":"","server":"29d635fb.a91c9a","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.garage_ac","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":270,"y":80,"wires":[[]]},{"id":"d8dadbd7.c378d8","type":"api-call-service","z":"cf48887c.47edf8","name":"","server":"29d635fb.a91c9a","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.garage_ac","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":270,"y":120,"wires":[[]]},{"id":"e9ffd395.2d1fe","type":"trigger-state","z":"cf48887c.47edf8","name":"Turned On","server":"29d635fb.a91c9a","entityid":"input_select.thermostat_upstairs","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"o3aik3z4kca","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"uoz96bbih8h","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":360,"y":230,"wires":[["32533607.b9fa9a"],[]]},{"id":"32533607.b9fa9a","type":"api-current-state","z":"cf48887c.47edf8","name":"Air/Heat Mode","server":"29d635fb.a91c9a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_select.thermostat_upstairs","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":535,"y":230,"wires":[["3b163dc4.031252"]]},{"id":"e87866a0.1fabb8","type":"comment","z":"cf48887c.47edf8","name":"Mode Change - Turn Off Units","info":"","x":140,"y":35,"wires":[]},{"id":"dd86c054.4a4d2","type":"comment","z":"cf48887c.47edf8","name":"Poll Every 10 Minutes","info":"checks for mode change and creates a\n10 minute \"minimum cycle time\" buffer","x":120,"y":185,"wires":[]},{"id":"5fb0d0d5.3d29","type":"comment","z":"cf48887c.47edf8","name":"System Turned On Manually","info":"","x":410,"y":185,"wires":[]},{"id":"4a3ead90.c7b984","type":"api-current-state","z":"cf48887c.47edf8","name":"Temp","server":"29d635fb.a91c9a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sensor.average_temp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":250,"y":305,"wires":[["81d4ee5.0ff381"]]},{"id":"594ad69a.2ff738","type":"api-current-state","z":"cf48887c.47edf8","name":"Target","server":"29d635fb.a91c9a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_number.targettemp_upstairs","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":250,"y":350,"wires":[["8bc42ccc.75de9"]]},{"id":"1c11dc1f.af4b94","type":"join","z":"cf48887c.47edf8","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":580,"y":305,"wires":[["7e106b82.6f4164"]]},{"id":"f1d55769.2b2928","type":"function","z":"cf48887c.47edf8","name":"Air","func":"if (msg.payload.up_temp - msg.payload.target_temp >= 0.5)\n{\n    msg.payload = 'on';\n}\nif (msg.payload.up_temp - msg.payload.target_temp <= 0.0)\n{\n    msg.payload = 'off';\n}\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":350,"wires":[["5bf68177.74727"]]},{"id":"8bc42ccc.75de9","type":"change","z":"cf48887c.47edf8","name":"target_temp","rules":[{"t":"change","p":"topic","pt":"msg","from":"input_number.targettemp_upstairs","fromt":"str","to":"target_temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":435,"y":350,"wires":[["1c11dc1f.af4b94"]]},{"id":"81d4ee5.0ff381","type":"change","z":"cf48887c.47edf8","name":"up_temp","rules":[{"t":"change","p":"topic","pt":"msg","from":"sensor.upstairs_temp","fromt":"str","to":"up_temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":425,"y":305,"wires":[["1c11dc1f.af4b94"]]},{"id":"d87a22b7.6d88c","type":"api-call-service","z":"cf48887c.47edf8","name":"Up Air Off","server":"29d635fb.a91c9a","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.upstairs_air_call","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":890,"y":305,"wires":[[]]},{"id":"856b1caa.92c6d","type":"api-call-service","z":"cf48887c.47edf8","name":"Air On","server":"29d635fb.a91c9a","version":"1","service_domain":"switch","service":"turn_on","entityId":"switch.upstairs_air_call","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1030,"y":395,"wires":[[]]},{"id":"9aeac790.5cc3a8","type":"api-call-service","z":"cf48887c.47edf8","name":"Heat Off","server":"29d635fb.a91c9a","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.garage_ac","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":890,"y":350,"wires":[[]]},{"id":"9298331a.a1378","type":"delay","z":"cf48887c.47edf8","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":890,"y":395,"wires":[["856b1caa.92c6d"]]},{"id":"fe22410.11c6dc","type":"inject","z":"cf48887c.47edf8","name":"","topic":"","payload":"","payloadType":"date","repeat":"600","crontab":"","once":true,"onceDelay":"2","x":90,"y":230,"wires":[["dff78485.3bc2c8"]]},{"id":"dff78485.3bc2c8","type":"api-current-state","z":"cf48887c.47edf8","name":"Air/Heat","server":"29d635fb.a91c9a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_select.thermostat_downstairs","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":80,"y":275,"wires":[["3b163dc4.031252"]]},{"id":"f3539c46.99564","type":"trigger-state","z":"cf48887c.47edf8","name":"Air","server":"29d635fb.a91c9a","entityid":"input_select.thermostat_upstairs","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"jslckm0wtmn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Air"},{"id":"5kh1d5l5gg3","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"Air"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":70,"y":120,"wires":[["fbae9610.09b098","d8dadbd7.c378d8"],[]]},{"id":"4b6861e.484afa","type":"function","z":"2ab0d9fb.322536","name":"Say whatever is input to this","func":"var payload=msg.payload;\nvar speak = msg.payload.speak\n\nmsg.payload = {\n    data: {\n        message: payload,\n        \n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":80,"wires":[["82a5ef48.a9083"]]},{"id":"13bdc1a.dc4b63e","type":"api-current-state","z":"e1506c1e.a4be5","name":"Kitchen","server":"29d635fb.a91c9a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sensor.kitchen_temperature","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":340,"y":440,"wires":[["f077c5cb.764f28"]]},{"id":"389c7f06.36f94","type":"debug","z":"e1506c1e.a4be5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":790,"y":500,"wires":[]},{"id":"a1624931.ea8b98","type":"inject","z":"e1506c1e.a4be5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":420,"wires":[["13bdc1a.dc4b63e","373f736.17a7a8c","5341e9e3.4ccbe8","87674ff7.e00a2"]]},{"id":"373f736.17a7a8c","type":"api-current-state","z":"e1506c1e.a4be5","name":"Thermostat","server":"29d635fb.a91c9a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sensor.temp","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":350,"y":500,"wires":[["f077c5cb.764f28"]]},{"id":"5341e9e3.4ccbe8","type":"api-current-state","z":"e1506c1e.a4be5","name":"Office","server":"29d635fb.a91c9a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sensor.office_temp","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":330,"y":560,"wires":[["f077c5cb.764f28"]]},{"id":"7160b643.33a078","type":"bigtimer","z":"5e27b596.12bbbc","outtopic":"shellies/shelly1-5BA8DD/relay/0/command","outpayload1":"on","outpayload2":"off","name":"Torch timer","comment":"","lat":"26.017642","lon":"-80.216987","starttime":"360","endtime":"540","starttime2":"1020","endtime2":"1380","startoff":"0","endoff":0,"startoff2":"","endoff2":"","offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":590,"y":160,"wires":[["7ce210f6.f0158"],[],[]]},{"id":"b45fb52d.499748","type":"inject","z":"5e27b596.12bbbc","name":"Auto","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":160,"wires":[["7160b643.33a078"]]},{"id":"6a189b5e.e5dc64","type":"inject","z":"5e27b596.12bbbc","name":"Off","topic":"","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":120,"wires":[["7160b643.33a078"]]},{"id":"9fc19991.569018","type":"comment","z":"5e27b596.12bbbc","name":"*******************************   Turns torch on and off using timer   *******************************","info":"","x":630,"y":40,"wires":[]},{"id":"9574c26e.98a19","type":"alexa-home","z":"5e27b596.12bbbc","conf":"7496d390.0337bc","device":"45927","acknoledge":true,"name":"goodnight","topic":"status/bedtime","x":80,"y":1000,"wires":[["169bf225.5f941e"]]},{"id":"b3a6c572.739118","type":"api-call-service","z":"5e27b596.12bbbc","name":"turn on nightstand","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.shelly_shsw_1_8b0000","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1090,"y":1020,"wires":[[]]},{"id":"e570a51.fbe5058","type":"delay","z":"5e27b596.12bbbc","name":"15 seconds","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1010,"y":1140,"wires":[["c7bc8d09.eb24f"]]},{"id":"72b4376.ae7a0c8","type":"api-call-service","z":"5e27b596.12bbbc","name":"turn off nightstand","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.shelly_shsw_1_8b0000","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1210,"y":1200,"wires":[[]]},{"id":"cb6ccf84.55976","type":"delay","z":"5e27b596.12bbbc","name":"20 seconds","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1010,"y":1200,"wires":[["72b4376.ae7a0c8"]]},{"id":"a5f5b8d.2703748","type":"change","z":"5e27b596.12bbbc","name":"Change to on","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":1020,"wires":[["b3a6c572.739118"]]},{"id":"e60d884e.96ec28","type":"change","z":"5e27b596.12bbbc","name":"Change to off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":1180,"wires":[["233b18b0.a9cf48","e570a51.fbe5058","cb6ccf84.55976","481ff294.efdb4c"]]},{"id":"abc2dce.d25402","type":"comment","z":"5e27b596.12bbbc","name":"***************************************   Bedtime sequence called by 'alexa, turn off goodnight' command   ***************************************","info":"","x":650,"y":900,"wires":[]},{"id":"c23b8893.f12d18","type":"link in","z":"5e27b596.12bbbc","name":"Timer for torch input","links":["65397258.dd9b7c","c7bc8d09.eb24f","1b60136d.b22ebd","18859996.ef75f6"],"x":270,"y":240,"wires":[["7160b643.33a078"]],"outputLabels":["Turns torch on from 'WAKE UP' and off from 'bedtime'"],"l":true},{"id":"c7bc8d09.eb24f","type":"link out","z":"5e27b596.12bbbc","name":"Turn off torch","links":["c23b8893.f12d18"],"x":1160,"y":1140,"wires":[],"inputLabels":["Turn off torch timer"],"l":true},{"id":"5bf68177.74727","type":"switch","z":"cf48887c.47edf8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"air","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":750,"y":360,"wires":[["d87a22b7.6d88c","9aeac790.5cc3a8"],["9298331a.a1378"]]},{"id":"87674ff7.e00a2","type":"api-current-state","z":"e1506c1e.a4be5","name":"","server":"29d635fb.a91c9a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_boolean.notify_home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":420,"y":360,"wires":[["220fbffe.1a2e6"]]},{"id":"220fbffe.1a2e6","type":"debug","z":"e1506c1e.a4be5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":740,"y":360,"wires":[]},{"id":"d304c8b4.8fbb68","type":"inject","z":"e1506c1e.a4be5","name":"","topic":"","payload":"open","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":640,"wires":[["8eada1a7.bbecb"]]},{"id":"99d11b1c.7e3168","type":"server-state-changed","z":"e1506c1e.a4be5","name":"Shop door open","server":"29d635fb.a91c9a","version":"1","entityidfilter":"cover.shop_garage_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":110,"y":720,"wires":[["8eada1a7.bbecb"]]},{"id":"8eada1a7.bbecb","type":"switch","z":"e1506c1e.a4be5","name":"Open or closed?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"closed","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":380,"y":680,"wires":[["7d3c40d5.04a7a"],["74a42282.a7d79c"]]},{"id":"7d3c40d5.04a7a","type":"stoptimer","z":"e1506c1e.a4be5","duration":"10","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":640,"y":760,"wires":[["c8be5094.9de7a"],[]]},{"id":"48964576.c7255c","type":"debug","z":"e1506c1e.a4be5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":930,"y":680,"wires":[]},{"id":"74a42282.a7d79c","type":"change","z":"e1506c1e.a4be5","name":"Send STOP","rules":[{"t":"set","p":"payload","pt":"msg","to":"STOP","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":780,"wires":[["7d3c40d5.04a7a"]]},{"id":"f6296194.40076","type":"inject","z":"e1506c1e.a4be5","name":"","topic":"","payload":"closed","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":680,"wires":[["8eada1a7.bbecb"]]},{"id":"c8be5094.9de7a","type":"change","z":"e1506c1e.a4be5","name":"Shop door is open!","rules":[{"t":"set","p":"payload","pt":"msg","to":"The shop door is open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":680,"wires":[["7d3c40d5.04a7a","48964576.c7255c","35744b7b.9f1d34"]]},{"id":"7899308c.a3a4b","type":"comment","z":"db2a1cbe.45656","name":"Thermostat for garage air conditioner","info":"","x":480,"y":40,"wires":[]},{"id":"c449779.bb1a388","type":"api-call-service","z":"5e27b596.12bbbc","name":"Turn off office light","server":"29d635fb.a91c9a","version":"1","service_domain":"light","service":"turn_off","entityId":"light.office_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1150,"y":1080,"wires":[[]]},{"id":"233b18b0.a9cf48","type":"delay","z":"5e27b596.12bbbc","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":990,"y":1080,"wires":[["c449779.bb1a388"]]},{"id":"31de2357.f0a18c","type":"link in","z":"e1506c1e.a4be5","name":"","links":[],"x":215,"y":780,"wires":[["74a42282.a7d79c"]]},{"id":"aec04c4d.26048","type":"comment","z":"e1506c1e.a4be5","name":"Jake in garage?","info":"","x":120,"y":780,"wires":[]},{"id":"dafd0490.b63c58","type":"function","z":"eff727ba.42a3a8","name":"Route to nearest","func":"\nnewmsg = {}\nentity_id = \"\";\nif (msg.payload == \"Office Motion\") {\n entity_id = \"light.office_pendant\"\n} \nelse if (msg.payload == \"Bathroom Motion\") {\n entity_id = \"switch.bathroom_light\"\n} \nelse if (msg.payload == \"Kitchen Motion\" || msg.payload == \"Dining Motion\") {\n entity_id = \"switch.edison_pendants\"\n}\nelse if (msg.payload == \"Living Room Motion\") {\n entity_id = \"light.middle_pendant\"\n}\nelse if (msg.payload == \"Closet Motion\") {\n entity_id = \"light.closet\"\n}\nelse {\n newmsg = \"NONE\"\n return newmsg;\n}\n \nnewmsg.payload = { data: {'entity_id': entity_id } } \nreturn newmsg;","outputs":1,"noerr":0,"x":270,"y":80,"wires":[[]]},{"id":"7d87f8dd.259758","type":"server-state-changed","z":"838b375b.a3fcd8","name":"Washer status","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.washer_power","entityidfiltertype":"substring","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":90,"y":40,"wires":[["679b9c9e.384a44"]]},{"id":"93b1b86a.027d48","type":"function","z":"838b375b.a3fcd8","name":"Was just done","func":"if(msg.data !== null && msg.data.old_state !== null) {\nif(msg.data.old_state.state === \"running\") {\nreturn msg\n}\n}\nreturn null;","outputs":1,"noerr":0,"x":460,"y":100,"wires":[["472d986c.401908"]]},{"id":"e15fba1e.f1bb68","type":"change","z":"838b375b.a3fcd8","name":"Reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":120,"wires":[[]]},{"id":"472d986c.401908","type":"delay","z":"838b375b.a3fcd8","name":"Wait 2 minutes","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":820,"y":80,"wires":[["ebe0be75.2be49"]]},{"id":"5927bbff.526d84","type":"function","z":"838b375b.a3fcd8","name":"Build an email","func":"msg = {\n    payload: \"The washer has finished. \" + Date().toString(),\n    topic: \"Washer is done\",\n};\nreturn msg;","outputs":1,"noerr":0,"x":1040,"y":140,"wires":[["7e9773ba.88381c"]]},{"id":"c8b32c8a.f7514","type":"server-state-changed","z":"838b375b.a3fcd8","name":"Dryer status","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.dryer_current","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":480,"wires":[["300e06df.9e5daa"]]},{"id":"19f0aa0c.54c556","type":"function","z":"838b375b.a3fcd8","name":"Was just done","func":"if(msg.data !== null && msg.data.old_state !== null) {\nif(msg.data.old_state.state === \"running\") {\nreturn msg\n}\n}\nreturn null;","outputs":1,"noerr":0,"x":400,"y":540,"wires":[["25ede00d.06f26"]]},{"id":"3a0b2bd7.5780b4","type":"change","z":"838b375b.a3fcd8","name":"Reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":580,"wires":[[]]},{"id":"25ede00d.06f26","type":"delay","z":"838b375b.a3fcd8","name":"Wait 2 minutes","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":680,"y":540,"wires":[["9191884a.8b31e8"]]},{"id":"f2e0c5da.192328","type":"function","z":"838b375b.a3fcd8","name":"Build an email","func":"msg = {\n    payload: \"The dryer has finished. \" + Date().toString(),\n    topic: \"Dryer is done\",\n};\nreturn msg;","outputs":1,"noerr":0,"x":960,"y":580,"wires":[["20e2bbad.514504"]]},{"id":"33fc5a2d.61e5d6","type":"api-call-service","z":"838b375b.a3fcd8","name":"Turn on IKEA light","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.color_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1130,"y":280,"wires":[[]]},{"id":"785e013a.704c9","type":"api-call-service","z":"838b375b.a3fcd8","name":"Turn off indicator","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.color_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":490,"y":760,"wires":[["31f84ea9.4dede2","dd02b426.36b258"]]},{"id":"55fa6c3d.5a2b54","type":"change","z":"838b375b.a3fcd8","name":"\"on\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":280,"wires":[["33fc5a2d.61e5d6"]]},{"id":"b32d54ff.ba1228","type":"change","z":"838b375b.a3fcd8","name":"Turn off","rules":[{"t":"set","p":"payload","pt":"msg","to":"turn_off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":760,"wires":[["785e013a.704c9"]]},{"id":"131b6873.9cb668","type":"api-call-service","z":"5e27b596.12bbbc","name":"Office Fan off","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"fan","service":"turn_off","entityId":"fan.office_fan","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1240,"y":1260,"wires":[[]]},{"id":"bfde9240.121ec","type":"change","z":"5e27b596.12bbbc","name":"Set to \"2\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":960,"wires":[["a576e813.c11138"]]},{"id":"a576e813.c11138","type":"api-call-service","z":"5e27b596.12bbbc","name":"Bedroom Fan on","server":"29d635fb.a91c9a","version":1,"service_domain":"fan","service":"turn_on","entityId":"fan.master_bedroom_fan","data":"{\"speed\":\"medium\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1060,"y":960,"wires":[[]]},{"id":"edf54a9e.c730c8","type":"server-state-changed","z":"e9c46f27.b8a08","name":"Cat detected","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.cat_detected","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":180,"wires":[[],["5bc680eb.7bd61"]]},{"id":"4838c742.7b5538","type":"inject","z":"e9c46f27.b8a08","name":"reset","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":190,"y":280,"wires":[["3329992e.956266"]]},{"id":"3329992e.956266","type":"function","z":"e9c46f27.b8a08","name":"Reset","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":280,"wires":[["b493d476.a47018"]]},{"id":"91802bd5.911048","type":"debug","z":"e9c46f27.b8a08","name":"count","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":870,"y":200,"wires":[]},{"id":"c93a8ad7.5d9828","type":"mqtt out","z":"e9c46f27.b8a08","name":"Poop count","topic":"poop/count","qos":"","retain":"","broker":"9afb58a1.205718","x":890,"y":140,"wires":[]},{"id":"53c3a617.9e9348","type":"server-state-changed","z":"e9c46f27.b8a08","name":"Drawer opened","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.litter_drawer","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":100,"y":340,"wires":[[],["3329992e.956266","f9abd2b.b81e43","a19cecba.97121"]]},{"id":"f9abd2b.b81e43","type":"trigger","z":"e9c46f27.b8a08","op1":"","op2":"Check the litter box","op1type":"nul","op2type":"str","duration":"96","extend":false,"units":"hr","reset":"","bytopic":"all","name":"","x":450,"y":340,"wires":[["923e119d.3c0b","bc934842.b2c0b8","66332825.3970e8"]]},{"id":"923e119d.3c0b","type":"mqtt out","z":"e9c46f27.b8a08","name":"Notify check litterbox","topic":"poop/check","qos":"","retain":"","broker":"9afb58a1.205718","x":940,"y":340,"wires":[]},{"id":"bc934842.b2c0b8","type":"debug","z":"e9c46f27.b8a08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":400,"wires":[]},{"id":"5bc680eb.7bd61","type":"trigger","z":"e9c46f27.b8a08","op1":"","op2":"","op1type":"nul","op2type":"date","duration":"7","extend":true,"units":"s","reset":"","bytopic":"all","name":"","x":320,"y":180,"wires":[["b493d476.a47018"]]},{"id":"d6984a63.c54a98","type":"mqtt in","z":"e9c46f27.b8a08","name":"Poop count","topic":"poop/count","qos":"2","broker":"9afb58a1.205718","x":110,"y":660,"wires":[["95c87cdc.79334","35c10970.2dc006"]]},{"id":"ca40be8e.72247","type":"mqtt out","z":"e9c46f27.b8a08","name":"Drawer last emptied","topic":"poop/lastemptied","qos":"","retain":"","broker":"9afb58a1.205718","x":700,"y":440,"wires":[]},{"id":"318fc25b.7ce20e","type":"mqtt in","z":"e9c46f27.b8a08","name":"Drawer last emptied","topic":"poop/lastemptied","qos":"2","broker":"9afb58a1.205718","x":130,"y":820,"wires":[["a8424618.6312e8"]]},{"id":"95c87cdc.79334","type":"debug","z":"e9c46f27.b8a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":660,"wires":[]},{"id":"a8424618.6312e8","type":"debug","z":"e9c46f27.b8a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":310,"y":820,"wires":[]},{"id":"94c47153.07e68","type":"function","z":"edb1bef3.011b5","name":"simpletime","func":"var ts = msg.timestamp || Date.now();\nvar d = new Date(ts);\ndt = d.toDateString();\ne = d.getTime();\n\nvar a = d.toJSON().split(/\\D+/);\nvar h = a[3];\nvar m = a[4];\nvar s = a[5];\n\nvar tm = (h+\":\"+m);\nvar tms = (h+\":\"+m+\":\"+s);\nvar ms = (m+\":\"+s);\n//msg.myrawdate = d;\n//msg.myepoch = e;\n//msg.mysecond = s;\n//msg.myminute = m;\n//msg.myminutes = ms;\n//msg.myhour = h;\nmsg.mytime = tm;\n//msg.mytimes = tms;\nmsg.mydate = dt;\n\nreturn msg;","outputs":1,"noerr":0,"x":311,"y":108,"wires":[[]]},{"id":"1b3fe99.2a41c16","type":"api-call-service","z":"5e27b596.12bbbc","name":"Stop music","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"media_player","service":"media_play_pause","entityId":"media_player.office","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":410,"y":980,"wires":[["5caf5588.b30abc"]]},{"id":"604db99f.6e5538","type":"inject","z":"e9c46f27.b8a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":480,"wires":[["46c9fa16.74ef74"]]},{"id":"683338d0.7e60a8","type":"api-call-service","z":"5e27b596.12bbbc","name":"Calendar tomorrow","server":"29d635fb.a91c9a","version":"1","service_domain":"media_player","service":"play_media","entityId":"media_player.office","data":"{\"media_content_id\":\"Alexa.Calendar.PlayTomorrow\",\"media_content_type\":\"sequence\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":730,"y":740,"wires":[[]]},{"id":"f6a0e7fd.c62428","type":"inject","z":"eff727ba.42a3a8","name":"Every Second","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"*/1 7-22 * * *","once":false,"onceDelay":0.1,"x":120,"y":560,"wires":[["58c1522b.b908cc"]]},{"id":"bbe9764b.39e298","type":"rbe","z":"eff727ba.42a3a8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":450,"y":560,"wires":[["f281f11f.ad7c5"]]},{"id":"58c1522b.b908cc","type":"function","z":"eff727ba.42a3a8","name":"Get Hour","func":"function gethour() {\n var date = new Date();\n var hour = (\"0\"+date.getHours()).substr(-2);\n return hour;\n}\n\nvar hour = gethour();\n\nvar talk = \"It is now \"\n\nvar talk2 = \" o'clock\"\n\nreturn {  payload : talk + hour + talk2 };","outputs":1,"noerr":0,"x":280,"y":560,"wires":[["bbe9764b.39e298"]]},{"id":"c2e90443.bfba38","type":"function","z":"cba02be5.02efe8","name":"Say whatever is input to this","func":"var payload=msg.payload;\nvar speak = msg.payload.speak\n\nmsg.payload = {\n    data: {\n        message: payload\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":140,"wires":[["6bd4c7cc.70aac8"]]},{"id":"a7911c7b.ca7d4","type":"link in","z":"eff727ba.42a3a8","name":"Send to All Alexi","links":["32dcd95b.e6b936","4448312c.171fb","4a9fa954.815c18","4ecc48a3.c61b98","5b39b2f4.72200c","61f7067f.990108","8a3660b7.68201","9537a190.2ca1a","d6209b9e.85a228","f6ad5eae.66cba","b5469e17.53278"],"x":360,"y":460,"wires":[["f281f11f.ad7c5"]],"l":true},{"id":"fd539eb2.95d2","type":"inject","z":"5e27b596.12bbbc","name":"The Garbage can has to go out tomorrow","topic":"","payload":"The Garbage cann has to go out tomorrow","payloadType":"str","repeat":"","crontab":"00 20 * * 2,5","once":false,"onceDelay":0.1,"x":430,"y":380,"wires":[["55ecc072.66b11"]]},{"id":"8e410b69.ac45a8","type":"inject","z":"5e27b596.12bbbc","name":"Calendar trigger","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"15 20 * * *","once":false,"onceDelay":0.1,"x":387,"y":740,"wires":[["683338d0.7e60a8"]]},{"id":"8995639b.761ea","type":"api-call-service","z":"5e27b596.12bbbc","name":"Torch OFF","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.shelly_shsw_1_5ba8dd","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1050,"y":160,"wires":[[]]},{"id":"7ce210f6.f0158","type":"switch","z":"5e27b596.12bbbc","name":"On or Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":880,"y":140,"wires":[["fe929817.cc9118"],["8995639b.761ea"]]},{"id":"fe929817.cc9118","type":"api-call-service","z":"5e27b596.12bbbc","name":"Torch ON","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.shelly_shsw_1_5ba8dd","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1049.0797996520996,"y":105.81955051422119,"wires":[[]]},{"id":"35c10970.2dc006","type":"influxdb out","z":"e9c46f27.b8a08","influxdb":"60236f0c.f6d7f","name":"","measurement":"poops.count","precision":"","retentionPolicy":"","x":510.07984924316406,"y":593.881965637207,"wires":[]},{"id":"1c9573b0.70796c","type":"change","z":"838b375b.a3fcd8","name":"Running","rules":[{"t":"set","p":"payload","pt":"msg","to":"running","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":20,"wires":[["b7933519.a6a648"]]},{"id":"679b9c9e.384a44","type":"switch","z":"838b375b.a3fcd8","name":"10W or more","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"10","vt":"num"},{"t":"lt","v":"2","vt":"num"},{"t":"lte","v":"1.9999","vt":"num"}],"checkall":"true","repair":false,"outputs":3,"x":230,"y":120,"wires":[["1c9573b0.70796c"],["b6d4bf9b.fe05a"],[]]},{"id":"b6d4bf9b.fe05a","type":"change","z":"838b375b.a3fcd8","name":"Stopped","rules":[{"t":"set","p":"payload","pt":"msg","to":"Stopped","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":200,"wires":[["a83eaf06.d17ff"]]},{"id":"5b5d54d0.23ce0c","type":"change","z":"838b375b.a3fcd8","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The washing machine is done!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":100,"wires":[["4e463cd4.8a1b84"]]},{"id":"ebe0be75.2be49","type":"rbe","z":"838b375b.a3fcd8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":753,"y":175.99997997283936,"wires":[["5b5d54d0.23ce0c","55fa6c3d.5a2b54","42414a88.5e7d64"]]},{"id":"2ac2b580.5d855a","type":"debug","z":"db2a1cbe.45656","name":"Garage Ti","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":580,"y":340,"wires":[]},{"id":"a47021e1.05461","type":"mqtt out","z":"db2a1cbe.45656","name":"garage/ac/state","topic":"garage/ac/state","qos":"","retain":"","broker":"9afb58a1.205718","x":1040,"y":160,"wires":[]},{"id":"5531318.be2edd","type":"server-state-changed","z":"db2a1cbe.45656","name":"Garage Temperature","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.garage_temperature","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":340,"wires":[["a4f04441.68e898"]]},{"id":"a3868205.a83a4","type":"switch","z":"db2a1cbe.45656","name":"Temp settings","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"78","vt":"num"},{"t":"gte","v":"80","vt":"num"},{"t":"eq","v":"Off","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":160,"y":140,"wires":[["f2f5e6a8.4d5408"],["60e5fe63.cc7e9"],["f2f5e6a8.4d5408"]]},{"id":"f2f5e6a8.4d5408","type":"api-current-state","z":"db2a1cbe.45656","name":"Already Off?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.garage_ac","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":390,"y":100,"wires":[[],["aff18e7c.13cdb"]]},{"id":"60e5fe63.cc7e9","type":"api-current-state","z":"db2a1cbe.45656","name":"Already On?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"60","halt_if_type":"num","halt_if_compare":"gte","override_topic":false,"entity_id":"sensor.garage_a_c_outlet_temperature","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":390,"y":180,"wires":[[],["22c965dc.981b5a"]]},{"id":"aff18e7c.13cdb","type":"api-call-service","z":"db2a1cbe.45656","name":"AC Power Off","server":"29d635fb.a91c9a","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.garage_ac","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":580,"y":100,"wires":[["3870a16b.57a80e"]]},{"id":"22c965dc.981b5a","type":"api-call-service","z":"db2a1cbe.45656","name":"AC Power On","server":"29d635fb.a91c9a","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.garage_ac","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":580,"y":180,"wires":[["99ea5b07.0d3b68"]]},{"id":"3870a16b.57a80e","type":"change","z":"db2a1cbe.45656","name":"Set state to Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"Off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":100,"wires":[["a47021e1.05461","92321fa2.ed0f2"]]},{"id":"99ea5b07.0d3b68","type":"change","z":"db2a1cbe.45656","name":"Set state to On","rules":[{"t":"set","p":"payload","pt":"msg","to":"On","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":180,"wires":[["a47021e1.05461","92321fa2.ed0f2"]]},{"id":"ecddde9a.a20a5","type":"comment","z":"db2a1cbe.45656","name":"Range 77 - 80 - Off","info":"","x":150,"y":80,"wires":[]},{"id":"e6aaed27.53f94","type":"comment","z":"db2a1cbe.45656","name":"sensor.garage.temperature","info":"","x":150,"y":300,"wires":[]},{"id":"7445a2fc.f0e2dc","type":"comment","z":"db2a1cbe.45656","name":"Operating Status","info":"","x":1040,"y":220,"wires":[]},{"id":"f07598c5.44c748","type":"mqtt in","z":"db2a1cbe.45656","name":"","topic":"garage/ac/state","qos":"2","datatype":"auto","broker":"9afb58a1.205718","x":820,"y":380,"wires":[["b378066e.dd84d8"]]},{"id":"b378066e.dd84d8","type":"debug","z":"db2a1cbe.45656","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":990,"y":380,"wires":[]},{"id":"92321fa2.ed0f2","type":"api-call-service","z":"db2a1cbe.45656","name":"A/C Status","server":"29d635fb.a91c9a","version":"1","service_domain":"input_boolean","service":"toggle","entityId":"input_boolean.garage_ac_on","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1050,"y":100,"wires":[[]]},{"id":"b930c731.3c6c28","type":"comment","z":"db2a1cbe.45656","name":"Update Timer Status","info":"","x":910,"y":540,"wires":[]},{"id":"1df7746e.cd7b2c","type":"comment","z":"db2a1cbe.45656","name":"On 8AM - 9PM","info":"","x":285,"y":555,"wires":[]},{"id":"da49f6fd.41e588","type":"function","z":"db2a1cbe.45656","name":"Timer Status","func":"global.set(\"bigtimer\",msg.payload)\nreturn msg;\n\n","outputs":2,"noerr":0,"x":500,"y":525,"wires":[["7c342f77.9967e"],[]]},{"id":"7c342f77.9967e","type":"debug","z":"db2a1cbe.45656","name":"BT Msg","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":670,"y":518,"wires":[]},{"id":"99967c80.3e572","type":"comment","z":"db2a1cbe.45656","name":"Global variable for status ","info":"","x":495,"y":480,"wires":[]},{"id":"466de948.592388","type":"comment","z":"db2a1cbe.45656","name":"Timer Control","info":"","x":275,"y":510,"wires":[]},{"id":"9247cc9b.e624c","type":"debug","z":"db2a1cbe.45656","name":"BT String","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":685,"y":630,"wires":[]},{"id":"3ab573de.03c2ec","type":"function","z":"db2a1cbe.45656","name":"Big Timer Status","func":"const [hours, minutes, seconds] = new Date(msg.duration * 60000 ).toISOString().substr(11, 8).split(\":\");\n\nmsg.payload = `${msg.payload} for ${hours > 0 ? `${hours} hrs ` : ''} ${minutes > 1 ? `${minutes} mins` : \"1 minute\"}`;\n//msg.payload = `${msg.payload} for ${hours > 0 ? `${hours} hrs and ` : ''} ${minutes > 0 ? `${minutes} minutes` : \"1 minute\"}`;\n\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"x":510,"y":587,"wires":[["9247cc9b.e624c"]]},{"id":"1a88353.b3283cb","type":"mqtt out","z":"db2a1cbe.45656","name":"","topic":"garage/ac/timerstate","qos":"1","retain":"","broker":"9afb58a1.205718","x":890,"y":585,"wires":[]},{"id":"85de697e.012a88","type":"bigtimer","z":"db2a1cbe.45656","outtopic":"","outpayload1":"","outpayload2":"","name":"Big Timer","comment":"","lat":"26.017642","lon":"-80.216987","starttime":"480","endtime":"1260","starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":275,"y":600,"wires":[["da49f6fd.41e588","3ab573de.03c2ec"],[],[]]},{"id":"a4f04441.68e898","type":"function","z":"db2a1cbe.45656","name":"Garage Temperature","func":"global.set(\"MCTI\",msg.payload) //sensor.garage.ti\n\nvar btstatus=global.get(\"bigtimer\") //BigTimer payload\nvar mctstatus=global.get(\"MCTI\")    //Garage.ti payload\nvar jakestatus=global.get(\"Jake\")  //device_tracker.jake\n//var disablestatus=global.get(\"garage_ac_disable\")  //disable status\n\nif(btstatus===\"Off\")  //If Timer is off, turn off control scheme\n{\n    msg.payload =\"Off\"; //Send Off payload to controls\n}\n\nif(btstatus===\"On\") //If timer is on, operate as normal\n{\n    if(jakestatus===\"not_home\")\n    {\n        msg.payload = \"Off\" //Turn off control scheme\n        \n    }\n    else if(jakestatus===\"home\")\n    msg.payload=mctstatus; //send temperature value to control scheme\n}\n\nreturn msg","outputs":1,"noerr":0,"x":360,"y":340,"wires":[["2ac2b580.5d855a","8ed61c34.b9ce3"]]},{"id":"f52cbda8.0fd39","type":"inject","z":"db2a1cbe.45656","name":"Off","topic":"","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":520,"wires":[["85de697e.012a88"]]},{"id":"7c7c245b.c56e9c","type":"server-state-changed","z":"db2a1cbe.45656","name":"Disable","server":"29d635fb.a91c9a","version":1,"entityidfilter":"input_boolean.garage_ac_disable","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":70,"y":640,"wires":[["85de697e.012a88"]]},{"id":"4db5bd8a.7d0bd4","type":"server-state-changed","z":"db2a1cbe.45656","name":"AC outlet temperature","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.garage_a_c_outlet_temperature","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":400,"wires":[[]]},{"id":"9562a72.3600758","type":"bigtimer","z":"e1506c1e.a4be5","outtopic":"","outpayload1":"","outpayload2":"","name":"Big Timer template","comment":"","lat":"26.017642","lon":"-80.216987","starttime":"360","endtime":"540","starttime2":"5001","endtime2":"1380","startoff":0,"endoff":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":1150,"y":400,"wires":[[],[],[]]},{"id":"17739665.f065fa","type":"api-call-service","z":"db2a1cbe.45656","name":"AC Power Off","server":"29d635fb.a91c9a","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.mr_cool_power","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":880,"y":1220,"wires":[["6cad9a86.3df1a4"]]},{"id":"68ae1cb8.176224","type":"api-call-service","z":"db2a1cbe.45656","name":"AC Power On","server":"29d635fb.a91c9a","version":"1","service_domain":"switch","service":"turn_on","entityId":"switch.mr_cool_power","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":880,"y":1279,"wires":[["60d4e0bf.8450d"]]},{"id":"9e2d9bc4.423028","type":"api-current-state","z":"db2a1cbe.45656","name":"Already Off?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.ac_air_outlet_louver","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":675,"y":1213,"wires":[[],["17739665.f065fa"]]},{"id":"63e5ed2b.683c84","type":"api-current-state","z":"db2a1cbe.45656","name":"Already On","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.ac_air_outlet_louver","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":675,"y":1273,"wires":[[],["68ae1cb8.176224"]]},{"id":"710a4f1a.1383c","type":"comment","z":"db2a1cbe.45656","name":"AC Control for MR Cool","info":"","x":120,"y":1108,"wires":[]},{"id":"4eac22b9.38679c","type":"mqtt out","z":"db2a1cbe.45656","name":"","topic":"hass/state/mrcool","qos":"2","retain":"","broker":"9afb58a1.205718","x":1295,"y":1249,"wires":[]},{"id":"60d4e0bf.8450d","type":"change","z":"db2a1cbe.45656","name":"Set state to On","rules":[{"t":"set","p":"payload","pt":"msg","to":"On","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1075,"y":1279,"wires":[["4eac22b9.38679c"]],"outputLabels":["Off"]},{"id":"6cad9a86.3df1a4","type":"change","z":"db2a1cbe.45656","name":"Set state to Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"Off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1075,"y":1219,"wires":[["4eac22b9.38679c"]],"outputLabels":["Off"]},{"id":"8d651502.ab6d18","type":"bigtimer","z":"db2a1cbe.45656","outtopic":"","outpayload1":"On","outpayload2":"Off","name":"Big Timer","comment":"","lat":"26.017642","lon":"-80.216987","starttime":"480","endtime":"5000","starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":110,"y":1663,"wires":[["a984f814.1a3bf8"],[],[]]},{"id":"5b9eab75.5109b4","type":"comment","z":"db2a1cbe.45656","name":"Update Timer Status","info":"","x":330,"y":1700,"wires":[]},{"id":"77c914a3.60c0bc","type":"comment","z":"db2a1cbe.45656","name":"On 8AM - 10PM","info":"","x":100,"y":1618,"wires":[]},{"id":"4ab541df.7acc7","type":"comment","z":"db2a1cbe.45656","name":"Update Operating Status","info":"","x":1285,"y":1204,"wires":[]},{"id":"c26bd3fe.6cc48","type":"debug","z":"db2a1cbe.45656","name":"Garage Temp","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":460,"y":1123,"wires":[]},{"id":"1260ab36.6a99e5","type":"server-state-changed","z":"db2a1cbe.45656","name":"Garage Temperature","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.garage_temperature","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":1198,"wires":[["fc631258.d3a21"]]},{"id":"fc631258.d3a21","type":"function","z":"db2a1cbe.45656","name":"Garage Temperature","func":"global.set(\"MCTI\",msg.payload) //sensor.garage.ti\n\nvar btstatus=global.get(\"bigtimer\") //BigTimer payload\nvar mctstatus=global.get(\"MCTI\")    //Garage.ti payload\nvar jakestatus=global.get(\"Jake\")  //device_tracker.jake\n\nif(btstatus===\"Off\")  //If Timer is off, turn off control scheme\n{\n    msg.payload =\"Off\"; //Send Off payload to controls\n}\n\nif(btstatus===\"On\") //If timer is on, operate as normal\n{\n    if(jakestatus===\"not_home\")\n    {\n        msg.payload = \"Off\" //Turn off control scheme\n        \n    }\n    else if(jakestatus===\"home\")\n    msg.payload=mctstatus; //send temperature value to control scheme\n}\n\nreturn msg","outputs":1,"noerr":0,"x":345,"y":1198,"wires":[["c26bd3fe.6cc48","b7d3a41e.96f948"]]},{"id":"643f0715.155378","type":"comment","z":"db2a1cbe.45656","name":"Sensor.garage_ti","info":"","x":100,"y":1153,"wires":[]},{"id":"cf5f6cae.370c3","type":"comment","z":"db2a1cbe.45656","name":"Timer Control","info":"","x":75,"y":1573,"wires":[]},{"id":"2ef2154.1b4faea","type":"server-state-changed","z":"db2a1cbe.45656","name":"Jake Status","server":"29d635fb.a91c9a","version":1,"entityidfilter":"person.jake","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":90,"y":1813,"wires":[["2d2a5132.cdd08e"]]},{"id":"a309ecdd.d086","type":"function","z":"db2a1cbe.45656","name":"Home or Away","func":"global.set(\"Mike\",msg.payload) //device_tracker.mike\nreturn msg;","outputs":1,"noerr":0,"x":565,"y":1806,"wires":[["33db6d25.480572"]]},{"id":"33db6d25.480572","type":"debug","z":"db2a1cbe.45656","name":"Jake","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":745,"y":1806,"wires":[]},{"id":"db38b497.f9c158","type":"stoptimer","z":"db2a1cbe.45656","duration":"20","units":"Second","payloadtype":"num","payloadval":"0","name":"Timer","x":410,"y":1840,"wires":[["a309ecdd.d086"],[]]},{"id":"70568b31.f9f6f4","type":"comment","z":"db2a1cbe.45656","name":"Global varaible for Mike's phone status","info":"","x":170,"y":1768,"wires":[]},{"id":"4a3c23c3.5a576c","type":"inject","z":"db2a1cbe.45656","name":"","topic":"","payload":"Off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":850,"y":1168,"wires":[["17739665.f065fa"]]},{"id":"ea596ba0.7d6378","type":"debug","z":"db2a1cbe.45656","name":"BT String","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":590,"y":1708,"wires":[]},{"id":"a984f814.1a3bf8","type":"function","z":"db2a1cbe.45656","name":"Big Timer Status","func":"global.set(\"bigtimer\",msg.payload)\n\nconst [hours, minutes, seconds] = new Date(msg.duration * 60000 ).toISOString().substr(11, 8).split(\":\");\n\nmsg.payload = `${msg.payload} for ${hours > 0 ? `${hours} hrs ` : ''} ${minutes > 1 ? `${minutes} mins` : \"1 minute\"}`;\n\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"x":325,"y":1650,"wires":[["ea596ba0.7d6378","1c538ec0.002601"]]},{"id":"1c538ec0.002601","type":"mqtt out","z":"db2a1cbe.45656","name":"","topic":"garage/ac/timerstate","qos":"1","retain":"","broker":"9afb58a1.205718","x":630,"y":1648,"wires":[]},{"id":"2d2a5132.cdd08e","type":"switch","z":"db2a1cbe.45656","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":280,"y":1813,"wires":[["a309ecdd.d086"],["db38b497.f9c158"]]},{"id":"4be302f5.e9a88c","type":"inject","z":"db2a1cbe.45656","name":"","topic":"","payload":"On","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":850,"y":1348,"wires":[["68ae1cb8.176224"]]},{"id":"1eca14f0.e81e6b","type":"comment","z":"db2a1cbe.45656","name":"Convert minutes  to hours, mins","info":"","x":375,"y":1603,"wires":[]},{"id":"55aeaa01.b97e74","type":"server-state-changed","z":"db2a1cbe.45656","name":"High Setpoint","server":"29d635fb.a91c9a","version":1,"entityidfilter":"input_select.ac_high_setpoint","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":90,"y":1363,"wires":[["527c98af.fc4e88"]]},{"id":"ef53f948.7f7038","type":"server-state-changed","z":"db2a1cbe.45656","name":"Low Setpoint","server":"29d635fb.a91c9a","version":1,"entityidfilter":"input_select.ac_low_setpoint","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":90,"y":1423,"wires":[["527c98af.fc4e88"]]},{"id":"ea8806a0.ff8948","type":"debug","z":"db2a1cbe.45656","name":"msg On","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":665,"y":1393,"wires":[]},{"id":"527c98af.fc4e88","type":"function","z":"db2a1cbe.45656","name":"On or Off","func":"const entities = global.get('homeassistant').homeAssistant.states;\nconst temp = entities[\"sensor.garage_temperature\"].state;\nconst high = Number(entities[\"input_select.ac_high_setpoint\"].state);\nconst low = Number(entities[\"input_select.ac_low_setpoint\"].state);\n\nif (temp >= high) {\n    msg.payload = \"On\"\n\n}\nif (temp <= low) {\n    msg.payload = \"Off\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":305,"y":1393,"wires":[["2fbf1f09.3d4b2"]]},{"id":"b7d3a41e.96f948","type":"switch","z":"db2a1cbe.45656","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Off","vt":"str"},{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":355,"y":1288,"wires":[["9e2d9bc4.423028"],["1c5a6bf4.cdf104","527c98af.fc4e88"]]},{"id":"1c5a6bf4.cdf104","type":"debug","z":"db2a1cbe.45656","name":"Temp","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":655,"y":1333,"wires":[]},{"id":"2fbf1f09.3d4b2","type":"switch","z":"db2a1cbe.45656","name":"On-Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"On","vt":"str"},{"t":"eq","v":"Off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":445,"y":1393,"wires":[["63e5ed2b.683c84","ea8806a0.ff8948"],["9e2d9bc4.423028","5699aecb.a2ede"]]},{"id":"5699aecb.a2ede","type":"debug","z":"db2a1cbe.45656","name":"msg Off","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":665,"y":1453,"wires":[]},{"id":"ce216f6e.41a2e","type":"api-call-service","z":"cba02be5.02efe8","name":"Office Alexa","server":"29d635fb.a91c9a","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"test\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.office\",\"serialNumber\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":550,"y":140,"wires":[[]]},{"id":"1df5b30b.7c87cd","type":"api-call-service","z":"cba02be5.02efe8","name":"Garage Alexa","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"test\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.garage\",\"serialNumber\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":560,"y":80,"wires":[[]]},{"id":"640abd70.580704","type":"api-call-service","z":"cba02be5.02efe8","name":"Kitchen Alexa","server":"29d635fb.a91c9a","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"test\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.kitchen\",\"serialNumber\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":560,"y":200,"wires":[[]]},{"id":"8abc33e6.fb469","type":"mqtt in","z":"25056595.dda88a","name":"Truck door","topic":"garage/cover/truck_door/state","qos":"0","datatype":"auto","broker":"9afb58a1.205718","x":80,"y":400,"wires":[["7a633306.34c7dc"]],"outputLabels":["Truck Door Opened"]},{"id":"f40c4a35.815b38","type":"mqtt in","z":"25056595.dda88a","name":"Shop door","topic":"garage/cover/shop_door/state","qos":"0","datatype":"auto","broker":"9afb58a1.205718","x":80,"y":320,"wires":[["cb890e5.04f40f"]],"outputLabels":["Truck Door Opened"]},{"id":"cb890e5.04f40f","type":"state-machine","z":"25056595.dda88a","name":"Open or Closed","triggerProperty":"payload","triggerPropertyType":"msg","stateProperty":"payload","statePropertyType":"msg","outputStateChangeOnly":true,"throwException":false,"states":["shop door closed","shop door open"],"transitions":[{"name":"open","from":"shop door closed","to":"shop door open"},{"name":"closed","from":"shop door open","to":"shop door closed"}],"x":240,"y":320,"wires":[["e3f8dc49.4731a"]]},{"id":"7a633306.34c7dc","type":"state-machine","z":"25056595.dda88a","name":"Open or Closed","triggerProperty":"payload","triggerPropertyType":"msg","stateProperty":"payload","statePropertyType":"msg","outputStateChangeOnly":true,"throwException":false,"states":["truck door closed","truck door open"],"transitions":[{"name":"open","from":"truck door closed","to":"truck door open"},{"name":"closed","from":"truck door open","to":"truck door closed"}],"x":240,"y":400,"wires":[["bd0e1997.edf3e8"]]},{"id":"bd0e1997.edf3e8","type":"rbe","z":"25056595.dda88a","name":"Filter","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":400,"wires":[["667cc5d9.bcbc7c"]]},{"id":"e3f8dc49.4731a","type":"rbe","z":"25056595.dda88a","name":"Filter","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":320,"wires":[["97b66533.4724b8"]]},{"id":"564f4212.1d01cc","type":"mqtt in","z":"25056595.dda88a","name":"911 Presence","topic":"homeassistant/binary_sensor/911/state","qos":"2","datatype":"auto","broker":"9afb58a1.205718","x":210,"y":820,"wires":[["3450e140.6b33ae"]]},{"id":"fdd03490.d20fc8","type":"mqtt in","z":"25056595.dda88a","name":"Smart Car Presence","topic":"homeassistant/binary_sensor/smart/state/","qos":"2","datatype":"auto","broker":"9afb58a1.205718","x":230,"y":880,"wires":[["cfac78b.e7f3088"]]},{"id":"3450e140.6b33ae","type":"change","z":"25056595.dda88a","name":"\"911 present\"","rules":[{"t":"change","p":"payload","pt":"msg","from":"ON","fromt":"str","to":"911 Present","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":820,"wires":[["3363ddb7.4b9d92"]]},{"id":"cfac78b.e7f3088","type":"change","z":"25056595.dda88a","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"connected","fromt":"str","to":"Smart Present","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"unavailable","fromt":"str","to":"Smart not present","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":880,"wires":[["3363ddb7.4b9d92"]]},{"id":"a4107056.fdb19","type":"inject","z":"25056595.dda88a","name":"Say something","topic":"","payload":"something","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":780,"y":440,"wires":[["97b66533.4724b8"]]},{"id":"3363ddb7.4b9d92","type":"rbe","z":"25056595.dda88a","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":890,"y":820,"wires":[["97b66533.4724b8"]]},{"id":"a1a860e0.d744","type":"server-state-changed","z":"25056595.dda88a","name":"Shop door closed","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.shop_door_sensor","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":100,"y":600,"wires":[["c1f806ab.1d05b8"],["56d0a544.d845fc"]]},{"id":"353f52ed.8c20de","type":"stoptimer","z":"25056595.dda88a","duration":"5","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":520,"y":620,"wires":[["98113609.be0df8"],[]]},{"id":"c1f806ab.1d05b8","type":"change","z":"25056595.dda88a","name":"Shop door","rules":[{"t":"set","p":"payload","pt":"msg","to":"The Shop Door ","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":580,"wires":[["353f52ed.8c20de"]]},{"id":"56d0a544.d845fc","type":"change","z":"25056595.dda88a","name":"Stop","rules":[{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":640,"wires":[["353f52ed.8c20de"]]},{"id":"98113609.be0df8","type":"switch","z":"25056595.dda88a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"stopped","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":730,"y":620,"wires":[[],["fd07fd8.7ec8d"]]},{"id":"460ff429.a2630c","type":"server-state-changed","z":"25056595.dda88a","name":"Truck door closed","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.truck_door_reed_switch","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":700,"wires":[["b0a51684.b40468"],["c91831d4.04963"]]},{"id":"905be033.51d4c","type":"stoptimer","z":"25056595.dda88a","duration":"5","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":520,"y":700,"wires":[["98113609.be0df8"],[]]},{"id":"b0a51684.b40468","type":"change","z":"25056595.dda88a","name":"Truck door","rules":[{"t":"set","p":"payload","pt":"msg","to":"The Truck Door ","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":680,"wires":[["905be033.51d4c"]]},{"id":"c91831d4.04963","type":"change","z":"25056595.dda88a","name":"Stop","rules":[{"t":"set","p":"payload","pt":"msg","to":"stop","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":740,"wires":[["905be033.51d4c"]]},{"id":"2d0f70aa.37c6b","type":"comment","z":"25056595.dda88a","name":"Tell me if a garage door has been open longer than the timer value.","info":"Somebody else wrote this as a reminder to close their garage door.\nI really *should* not require this, but it didn't hurt me to leave it as a double-check.","x":560,"y":520,"wires":[]},{"id":"fd07fd8.7ec8d","type":"function","z":"25056595.dda88a","name":"Build message","func":"msg.payload += \" has been open for 5 minutes\";\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":680,"wires":[["82ea8589.0608b8","97b66533.4724b8"]]},{"id":"e6b36d19.fce0a","type":"server-state-changed","z":"25056595.dda88a","name":"Smart active","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.smart","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":1700,"wires":[["f2efdc74.4d32"]]},{"id":"2e7cc5f4.3b4b2a","type":"api-call-service","z":"25056595.dda88a","name":"Smart detected","server":"29d635fb.a91c9a","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.smart_esphome_detected","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":280,"y":1760,"wires":[["20af03f9.58390c"]]},{"id":"f2efdc74.4d32","type":"function","z":"25056595.dda88a","name":"Car or No Car","func":"if (msg.payload>0){\n    return[msg,null];\n}else if(msg.payload==\"unavailable\"){\n    return[null,msg];\n}","outputs":2,"noerr":0,"x":140,"y":1820,"wires":[["2e7cc5f4.3b4b2a"],["f9f2974e.b9c468"]]},{"id":"20af03f9.58390c","type":"api-current-state","z":"25056595.dda88a","name":"Armed?","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.disarm_smart_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":440,"y":1740,"wires":[["fda56f2f.28606"]]},{"id":"4a995b32.6941c4","type":"debug","z":"25056595.dda88a","name":"Armed","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":1110,"y":1700,"wires":[]},{"id":"fda56f2f.28606","type":"function","z":"25056595.dda88a","name":"Armed or not?","func":"if (msg.payload==\"off\"){\n    msg.payload = \"Door armed\";\n    return[msg,null];\n}else if(msg.payload==\"on\"){\n    msg.payload = \"Door not armed\";\n    return[null,msg];\n}","outputs":2,"noerr":0,"x":620,"y":1760,"wires":[["9d392962.346858","835efb28.758468"],["8a4b1bc9.7c2278","835efb28.758468"]]},{"id":"de03c2d2.a1571","type":"debug","z":"25056595.dda88a","name":"Not armed","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":1110,"y":1820,"wires":[]},{"id":"f3d22da0.f5514","type":"api-call-service","z":"25056595.dda88a","name":"Smart not detected","server":"29d635fb.a91c9a","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.smart_esphome_detected","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":530,"y":1920,"wires":[["835efb28.758468"]]},{"id":"9d392962.346858","type":"api-call-service","z":"25056595.dda88a","name":"Open truck door","server":"29d635fb.a91c9a","version":1,"service_domain":"cover","service":"open_cover","entityId":"cover.truck_door","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":880,"y":1700,"wires":[["4a995b32.6941c4"]]},{"id":"f3f1333a.40102","type":"delay","z":"25056595.dda88a","name":"","pauseType":"delay","timeout":"60","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":960,"y":1920,"wires":[["fcbbab75.9b0668"]]},{"id":"8a4b1bc9.7c2278","type":"function","z":"25056595.dda88a","name":"Build an email","func":"msg = {\n    from: 'jakekooser@gmail.com',\n    payload: \"There was an attempt to open the door but it was not armed. \" + Date().toString(),\n    topic: \"Door attempt\",\n};\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":1800,"wires":[["de03c2d2.a1571"]]},{"id":"67c3823d.8b68dc","type":"comment","z":"25056595.dda88a","name":"Car boolean ON","info":"","x":340,"y":1840,"wires":[]},{"id":"2910358a.08a50a","type":"comment","z":"25056595.dda88a","name":"Manual disarm","info":"","x":540,"y":1700,"wires":[]},{"id":"fc352f65.d14a3","type":"comment","z":"25056595.dda88a","name":"Close door after timer","info":"","x":940,"y":1880,"wires":[]},{"id":"a38960ed.b497f","type":"comment","z":"25056595.dda88a","name":"\"unavailable\" or not","info":"","x":130,"y":1860,"wires":[]},{"id":"29647cee.86d4a4","type":"comment","z":"25056595.dda88a","name":"Car boolean OFF","info":"","x":380,"y":1980,"wires":[]},{"id":"667cc5d9.bcbc7c","type":"delay","z":"25056595.dda88a","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":600,"y":380,"wires":[["97b66533.4724b8"]]},{"id":"7123ee7d.05bdc","type":"comment","z":"25056595.dda88a","name":"Close both doors","info":"1. Toggle input boolean that I have set up as an entity button in Lovelace.\n2. Checks state of both doors.\n3. If closed, report 'door not open'\n4. If not closed, close door\n5. There is a 3 second delay to allow the announcements to not step on each other.","x":580,"y":20,"wires":[]},{"id":"167e7403.2c29ac","type":"comment","z":"25056595.dda88a","name":"Announce door movement on phone","info":"Gets door states from MQTT and sends the status to my phone VIA MQTT 'say'","x":600,"y":280,"wires":[]},{"id":"6dcf6c3.fbe1294","type":"server-state-changed","z":"25056595.dda88a","name":"Smart","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.smart_opened_garage","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":210,"y":940,"wires":[["cfac78b.e7f3088"]]},{"id":"835efb28.758468","type":"traffic","z":"25056595.dda88a","name":"","property_allow":"payload","filter_allow":"Door armed","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"Door not armed","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":770,"y":1920,"wires":[["f3f1333a.40102"]]},{"id":"8abf0a9c.131c18","type":"server-state-changed","z":"25056595.dda88a","name":"911 active","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.911","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":100,"y":1300,"wires":[["6225bee6.5e776"]]},{"id":"9a7af2aa.3b46c","type":"api-call-service","z":"25056595.dda88a","name":"911 detected","server":"29d635fb.a91c9a","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.911_esphome_detected","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":330,"y":1360,"wires":[["6f2db72f.75e0e8"]]},{"id":"6225bee6.5e776","type":"function","z":"25056595.dda88a","name":"Car or No Car","func":"if (msg.payload>0){\n    return[msg,null];\n}else if(msg.payload==\"unavailable\"){\n    return[null,msg];\n}","outputs":2,"noerr":0,"x":140,"y":1420,"wires":[["9a7af2aa.3b46c"],["b306204e.e1456"]]},{"id":"6f2db72f.75e0e8","type":"api-current-state","z":"25056595.dda88a","name":"Armed?","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.disarm_911_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":500,"y":1340,"wires":[["39ede1fb.c5b60e"]]},{"id":"abbfe54d.c41448","type":"debug","z":"25056595.dda88a","name":"Armed","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":1110,"y":1260,"wires":[]},{"id":"39ede1fb.c5b60e","type":"function","z":"25056595.dda88a","name":"Armed or not?","func":"if (msg.payload==\"off\"){\n    msg.payload = \"Door armed\";\n    return[msg,null];\n}else if(msg.payload==\"on\"){\n    msg.payload = \"Door not armed\";\n    return[null,msg];\n}","outputs":2,"noerr":0,"x":660,"y":1380,"wires":[["67c590f3.5c5de","83e62edf.9b8e7"],["1bd766e3.e18679","83e62edf.9b8e7"]]},{"id":"ada1ae80.3a262","type":"debug","z":"25056595.dda88a","name":"Not armed","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":1110,"y":1420,"wires":[]},{"id":"b306204e.e1456","type":"api-call-service","z":"25056595.dda88a","name":"911 not detected","server":"29d635fb.a91c9a","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.911_esphome_detected","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":310,"y":1480,"wires":[["83e62edf.9b8e7"]]},{"id":"67c590f3.5c5de","type":"api-call-service","z":"25056595.dda88a","name":"Open shop door","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"cover","service":"open_cover","entityId":"cover.shop_door","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":1260,"wires":[["abbfe54d.c41448"]]},{"id":"d6c6db4.5202728","type":"delay","z":"25056595.dda88a","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":1520,"wires":[["bc7ac8c6.417478"]]},{"id":"1bd766e3.e18679","type":"function","z":"25056595.dda88a","name":"Build an email","func":"msg = {\n    from: 'jakekooser@gmail.com',\n    payload: \"There was an attempt to open the door but it was not armed. \" + Date().toString(),\n    topic: \"Door attempt\",\n};\nreturn msg;","outputs":1,"noerr":0,"x":920,"y":1420,"wires":[["ada1ae80.3a262"]]},{"id":"e6e7f7e0.d307d8","type":"comment","z":"25056595.dda88a","name":"Car boolean ON","info":"","x":320,"y":1320,"wires":[]},{"id":"acf660a3.e027a","type":"comment","z":"25056595.dda88a","name":"Manual disarm","info":"","x":620,"y":1300,"wires":[]},{"id":"1f7e9eab.bedaf1","type":"comment","z":"25056595.dda88a","name":"Close door after timer","info":"","x":900,"y":1480,"wires":[]},{"id":"2aea563.4956aaa","type":"comment","z":"25056595.dda88a","name":"\"unavailable\" or not","info":"","x":110,"y":1460,"wires":[]},{"id":"eec747e6.401e38","type":"comment","z":"25056595.dda88a","name":"Car boolean OFF","info":"","x":330,"y":1440,"wires":[]},{"id":"83e62edf.9b8e7","type":"traffic","z":"25056595.dda88a","name":"","property_allow":"payload","filter_allow":"Door armed","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"Door not armed","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":830,"y":1520,"wires":[["d6c6db4.5202728"]]},{"id":"c0da68c5.81f4f8","type":"comment","z":"25056595.dda88a","name":"------------------------------------- This controls door 1, VIA vehicle 1 -------------------------------------","info":"","x":670,"y":1220,"wires":[]},{"id":"aeaf9ea0.233d","type":"comment","z":"25056595.dda88a","name":"------------------------------------- This controls door 2, VIA vehicle 2 -------------------------------------","info":"","x":690,"y":1660,"wires":[]},{"id":"aa3eb188.eca2d","type":"alexa-home","z":"a13f7cde.5004","conf":"7496d390.0337bc","device":"67686","acknoledge":true,"name":"shutdown","topic":"status/garage","x":260,"y":500,"wires":[["9280e1eb.ed20e"]]},{"id":"44e7a081.a8344","type":"api-call-service","z":"a13f7cde.5004","name":"turn off stereo","server":"29d635fb.a91c9a","version":1,"service_domain":"media_player","service":"turn_off","entityId":"media_player.garage_avr","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":820,"y":560,"wires":[[]]},{"id":"f974f22f.61b3c","type":"change","z":"a13f7cde.5004","name":"Change to off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":500,"wires":[["e47df3d.892961","f63ce0d6.00e3a","44e7a081.a8344"]]},{"id":"6978ddaa.6e2b04","type":"comment","z":"a13f7cde.5004","name":"Stops garage music, turns off fan and a/c","info":"Placeholder","x":680,"y":380,"wires":[]},{"id":"e47df3d.892961","type":"api-call-service","z":"a13f7cde.5004","name":"Turn off garage fan","server":"29d635fb.a91c9a","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.garage_fan","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":830,"y":440,"wires":[[]]},{"id":"9280e1eb.ed20e","type":"api-call-service","z":"a13f7cde.5004","name":"Stop music","server":"29d635fb.a91c9a","version":1,"service_domain":"media_player","service":"media_play_pause","entityId":"media_player.garage","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":410,"y":500,"wires":[["f974f22f.61b3c"]]},{"id":"f63ce0d6.00e3a","type":"api-call-service","z":"a13f7cde.5004","name":"Turn off garage AC","server":"29d635fb.a91c9a","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.garage_ac","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":830,"y":500,"wires":[[]]},{"id":"373678a7.dd6178","type":"alexa-home","z":"a13f7cde.5004","conf":"7496d390.0337bc","device":"67687","acknoledge":true,"name":"start garage","topic":"status/garage","x":270,"y":200,"wires":[["8d519986.271598"]]},{"id":"a39e92c5.8535e","type":"change","z":"a13f7cde.5004","name":"Change to on","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":200,"wires":[["90a9c5e.d488338","46811198.9bbd9","d21ec758.17adf8","21d7065c.7b3d6a"]]},{"id":"847ad422.206d98","type":"comment","z":"a13f7cde.5004","name":"Starts garage music, turns on fan and a/c","info":"Placeholder","x":660,"y":100,"wires":[]},{"id":"90a9c5e.d488338","type":"api-call-service","z":"a13f7cde.5004","name":"Turn on garage fan","server":"29d635fb.a91c9a","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.garage_fan","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":850,"y":140,"wires":[[]]},{"id":"46811198.9bbd9","type":"api-call-service","z":"a13f7cde.5004","name":"Turn on garage AC","server":"29d635fb.a91c9a","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.garage_ac","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":850,"y":200,"wires":[[]]},{"id":"8d519986.271598","type":"api-call-service","z":"a13f7cde.5004","name":"Play KEXP","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.garage","data":"{\"media_content_id\":\"k. e. x. p.\",\"media_content_type\":\"TUNEIN\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":430,"y":200,"wires":[["a39e92c5.8535e"]]},{"id":"f4bb847e.e217b8","type":"inject","z":"a13f7cde.5004","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":400,"y":600,"wires":[["44e7a081.a8344"]]},{"id":"d21ec758.17adf8","type":"api-call-service","z":"a13f7cde.5004","name":"turn on stereo","server":"29d635fb.a91c9a","version":1,"service_domain":"media_player","service":"turn_on","entityId":"media_player.garage_avr","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":840,"y":260,"wires":[[]]},{"id":"21d7065c.7b3d6a","type":"debug","z":"a13f7cde.5004","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","x":830,"y":320,"wires":[]},{"id":"222ca778.23ee28","type":"function","z":"215b943e.474c3c","name":"Journal email","func":"msg = {\n    from: 'jakekooser@gmail.com',\n    payload: \"How did your day go? Just reply to this email. \" + Date().toString(),\n    topic: \"How did your day go?\",\n};\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":80,"wires":[["4bda7acf.a548d4"]]},{"id":"8057c507.d873e8","type":"inject","z":"215b943e.474c3c","name":"Every day at 8 PM","topic":"This is the payload","payload":"","payloadType":"date","repeat":"","crontab":"00 20 * * *","once":false,"onceDelay":0.1,"x":170,"y":80,"wires":[["222ca778.23ee28"]]},{"id":"acf5381d.6f21a8","type":"e-mail","z":"a2de79f8.d4c028","server":"smtp.gmail.com","port":"465","secure":true,"tls":false,"name":"jakekooser@gmail.com","dname":"VIA gmail","x":200,"y":80,"wires":[]},{"id":"4bda7acf.a548d4","type":"link out","z":"215b943e.474c3c","name":"Send Journal email","links":["5fd87172.8ea7d"],"x":530,"y":80,"wires":[],"l":true},{"id":"5fd87172.8ea7d","type":"link in","z":"215b943e.474c3c","name":"I send email","links":["4bda7acf.a548d4","9ea26474.b6b448","d85a5b30.116c88"],"x":910,"y":80,"wires":[["eedbac4e.733fe"]],"l":true},{"id":"a4179fab.e12cf","type":"comment","z":"215b943e.474c3c","name":"****************   Daily journal email   ****************","info":"","x":320,"y":40,"wires":[]},{"id":"bd2f746e.ae85a8","type":"comment","z":"215b943e.474c3c","name":"****************   Send formatted email to this link only   ****************","info":"","x":940,"y":40,"wires":[]},{"id":"5302ec95.2114d4","type":"comment","z":"eac2df63.5cf68","name":"****************   Converts charging current for lovelace display   ****************","info":"","x":520,"y":180,"wires":[]},{"id":"65e25d18.398374","type":"comment","z":"eac2df63.5cf68","name":"****************   Updates car charging status for phone and lovelace   ****************","info":"","x":520,"y":40,"wires":[]},{"id":"4ca2a2f5.376d8c","type":"mqtt in","z":"eac2df63.5cf68","name":"OVMS state of charge","topic":"ovms/OVMS/JK4or2wo/metric/v/b/soc","qos":"2","datatype":"auto","broker":"9afb58a1.205718","x":300,"y":380,"wires":[["858ca62e.de2c08"]]},{"id":"de1f91ee.e0d5e","type":"comment","z":"eac2df63.5cf68","name":"****************   Reads SoC from OVMS   ****************","info":"","x":500,"y":320,"wires":[]},{"id":"858ca62e.de2c08","type":"mqtt out","z":"eac2df63.5cf68","name":"State of Charge","topic":"ovms/soc","qos":"1","retain":"","broker":"9afb58a1.205718","x":750,"y":380,"wires":[]},{"id":"fdb78fc6.29f2d","type":"debug","z":"8b414f68.37d25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":1030,"y":1060,"wires":[]},{"id":"46d60c47.4b2564","type":"mqtt in","z":"8b414f68.37d25","name":"","topic":"openevse/amp","qos":"2","datatype":"auto","broker":"9afb58a1.205718","x":140,"y":940,"wires":[[]]},{"id":"159e7f5e.e9a471","type":"ha-wait-until","z":"8b414f68.37d25","name":"Is Jake home","server":"29d635fb.a91c9a","outputs":2,"entityId":"person.jake_person","entityIdFilterType":"exact","property":"state","comparator":"is","value":"home","valueType":"str","timeout":"3","timeoutType":"num","timeoutUnits":"seconds","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":450,"y":860,"wires":[["ae7a357.6f8abc8","325ad1f6.8000ae"],["8e7c6918.5a86f8"]]},{"id":"dd1de71c.ce5d58","type":"link in","z":"8b414f68.37d25","name":"Test for Jake","links":["8ad3e57d.1cb318","8ed61c34.b9ce3","a4851a97.e03288","da631ee8.d77f","f8d2843.ea23478"],"x":150,"y":880,"wires":[["159e7f5e.e9a471"]],"l":true},{"id":"325ad1f6.8000ae","type":"link out","z":"8b414f68.37d25","name":"Jake test result","links":["358c5a36.e9af16","6e92229c.e4082c","8d5a8a38.488668","9cfec3a1.5db53","bec15c50.7ef78"],"x":1060,"y":820,"wires":[],"l":true},{"id":"a4851a97.e03288","type":"link out","z":"8b414f68.37d25","name":"Test for Jake","links":["dd1de71c.ce5d58"],"x":170,"y":800,"wires":[],"l":true},{"id":"bec15c50.7ef78","type":"link in","z":"8b414f68.37d25","name":"Result","links":["325ad1f6.8000ae"],"x":810,"y":1020,"wires":[["fdb78fc6.29f2d","3a28d9dc.f9c396"]],"l":true},{"id":"b7933519.a6a648","type":"api-call-service","z":"838b375b.a3fcd8","name":"Show status","server":"29d635fb.a91c9a","version":1,"service_domain":"input_text","service":"set_value","entityId":"input_text.washer_running","data":"{\"entity_id\":\"input_text.washer_running\", \"value\":\"Washing bitch\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":470,"y":20,"wires":[["93b1b86a.027d48","2dccb0e9.416fa"]]},{"id":"e8fa2992.7e6068","type":"api-call-service","z":"838b375b.a3fcd8","name":"Show status","server":"29d635fb.a91c9a","version":1,"service_domain":"input_text","service":"set_value","entityId":"input_text.dryer_running","data":"{\"entity_id\":\"input_text.dryer_running\", \"value\":\"Drying bitch\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":490,"y":480,"wires":[["19f0aa0c.54c556","b0d067e3.da4ad8"]]},{"id":"300e06df.9e5daa","type":"switch","z":"838b375b.a3fcd8","name":"1.25A or more","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"1.25","vt":"num"},{"t":"lt","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":140,"y":580,"wires":[["306215d1.fc4bba"],["e187ffc3.f651e"],[]]},{"id":"306215d1.fc4bba","type":"change","z":"838b375b.a3fcd8","name":"Running","rules":[{"t":"set","p":"payload","pt":"msg","to":"running","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":480,"wires":[["e8fa2992.7e6068"]]},{"id":"e187ffc3.f651e","type":"change","z":"838b375b.a3fcd8","name":"Stopped","rules":[{"t":"set","p":"payload","pt":"msg","to":"Stopped","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":640,"wires":[["e92b65f7.233108"]]},{"id":"f0d782aa.3f65e","type":"change","z":"838b375b.a3fcd8","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The dryer is done!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930.9964098930359,"y":539.656252861023,"wires":[["7d37a7ec.a54b98"]]},{"id":"9191884a.8b31e8","type":"rbe","z":"838b375b.a3fcd8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":650,"y":620,"wires":[["f0d782aa.3f65e","55fa6c3d.5a2b54","9c6840a9.0ccf5"]]},{"id":"a83eaf06.d17ff","type":"api-call-service","z":"838b375b.a3fcd8","name":"Show status","server":"29d635fb.a91c9a","version":1,"service_domain":"input_text","service":"set_value","entityId":"input_text.washer_running","data":"{\"entity_id\":\"input_text.washer_running\", \"value\":\"Washing finished\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":200,"wires":[[]]},{"id":"e92b65f7.233108","type":"api-call-service","z":"838b375b.a3fcd8","name":"Show status","server":"29d635fb.a91c9a","version":1,"service_domain":"input_text","service":"set_value","entityId":"input_text.dryer_running","data":"{\"entity_id\":\"input_text.dryer_running\", \"value\":\"Dryer finished\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":450,"y":640,"wires":[[]]},{"id":"b0d067e3.da4ad8","type":"api-call-service","z":"838b375b.a3fcd8","name":"Dryer LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_on","entityId":"light.dryer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":750,"y":480,"wires":[[]]},{"id":"2dccb0e9.416fa","type":"api-call-service","z":"838b375b.a3fcd8","name":"Washer LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_on","entityId":"light.washer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":650,"y":20,"wires":[[]]},{"id":"31f84ea9.4dede2","type":"delay","z":"838b375b.a3fcd8","name":"Wait 2 minutes","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":700,"y":760,"wires":[["55c5eac4.c7e0f4"]]},{"id":"6336d00.7a0ea3","type":"delay","z":"838b375b.a3fcd8","name":"Wait 7 minutes","pauseType":"delay","timeout":"7","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1060,"y":760,"wires":[["9df9559c.81fb38"]]},{"id":"55c5eac4.c7e0f4","type":"api-call-service","z":"838b375b.a3fcd8","name":"Turn on BR light","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.bedroom_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":880,"y":760,"wires":[["6336d00.7a0ea3"]]},{"id":"9df9559c.81fb38","type":"api-call-service","z":"838b375b.a3fcd8","name":"Turn off BR light","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_off","entityId":"light.bedroom_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1240,"y":760,"wires":[[]]},{"id":"9c6840a9.0ccf5","type":"api-call-service","z":"838b375b.a3fcd8","name":"Dryer LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_off","entityId":"light.dryer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":870,"y":640,"wires":[["cc300224.669e1"]]},{"id":"42414a88.5e7d64","type":"api-call-service","z":"838b375b.a3fcd8","name":"Washer LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_off","entityId":"light.washer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":930,"y":180,"wires":[["52c5ddba.16de44"]]},{"id":"cc300224.669e1","type":"api-call-service","z":"838b375b.a3fcd8","name":"Show status","server":"29d635fb.a91c9a","version":1,"service_domain":"input_text","service":"set_value","entityId":"input_text.dryer_running","data":"{\"entity_id\":\"input_text.dryer_running\", \"value\":\"Chilling\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1110,"y":640,"wires":[[]]},{"id":"52c5ddba.16de44","type":"api-call-service","z":"838b375b.a3fcd8","name":"Show status","server":"29d635fb.a91c9a","version":1,"service_domain":"input_text","service":"set_value","entityId":"input_text.washer_running","data":"{\"entity_id\":\"input_text.washer_running\", \"value\":\"Chilling\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1150,"y":180,"wires":[[]]},{"id":"d78a6293.285a6","type":"inject","z":"215b943e.474c3c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":280,"wires":[["d49c77c2.dc1d98"]]},{"id":"79b37ffa.7f51","type":"debug","z":"215b943e.474c3c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":610,"y":280,"wires":[]},{"id":"4c774fc5.4f94","type":"function","z":"215b943e.474c3c","name":"Build an email template","func":"msg = {\n    from: 'jakekooser@gmail.com',\n    payload: \"This is the message body\" + Date().toString(),\n    topic: \"This is the subject\",\n};\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":220,"wires":[["eedbac4e.733fe"]]},{"id":"d49c77c2.dc1d98","type":"moment","z":"215b943e.474c3c","name":"Time (object)","topic":"","input":"","inputType":"msg","inTz":"America/New_York","adjAmount":"1","adjType":"months","adjDir":"add","format":"object","locale":"en","output":"time","outputType":"msg","outTz":"America/New_York","x":250,"y":280,"wires":[["406e73b1.c9a16c"]]},{"id":"406e73b1.c9a16c","type":"function","z":"215b943e.474c3c","name":"Build a date template","func":"var payload=msg.payload;\nmsg.payload=msg.time.months + \"/\" + msg.time.date + \"/\" + msg.time.years;\n\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":280,"wires":[["79b37ffa.7f51"]]},{"id":"8ed61c34.b9ce3","type":"link out","z":"db2a1cbe.45656","name":"","links":["dd1de71c.ce5d58"],"x":95,"y":240,"wires":[]},{"id":"c255a01a.18fc2","type":"comment","z":"db2a1cbe.45656","name":"Jake test","info":"","x":180,"y":240,"wires":[]},{"id":"9cfec3a1.5db53","type":"link in","z":"db2a1cbe.45656","name":"","links":["325ad1f6.8000ae"],"x":275,"y":240,"wires":[["a3868205.a83a4","2b115429.6cee1c"]]},{"id":"f9f2974e.b9c468","type":"trigger","z":"25056595.dda88a","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"20","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":330,"y":1920,"wires":[["f3d22da0.f5514"]]},{"id":"c6a82347.81e2","type":"inject","z":"db2a1cbe.45656","name":"On","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":580,"wires":[["85de697e.012a88"]]},{"id":"2b115429.6cee1c","type":"debug","z":"db2a1cbe.45656","name":"Jake here?","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":450,"y":240,"wires":[]},{"id":"16ecbff7.948fd","type":"function","z":"2b590643.985dca","name":"Was just done","func":"if(msg.data !== null && msg.data.old_state !== null) {\nif(msg.data.old_state.state === \"Printing\") {\nreturn msg\n}\n}\nreturn null;","outputs":1,"noerr":0,"x":500,"y":200,"wires":[["d77e3775.0a0ef8"]]},{"id":"6dfea77.3d5eb58","type":"server-state-changed","z":"2b590643.985dca","name":"Kingroon state","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.octoprint_current_state","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":200,"wires":[["16ecbff7.948fd"]]},{"id":"ebe667f7.be8e68","type":"api-current-state","z":"2b590643.985dca","name":"Kingroon","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.octoprint_current_state","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":260,"y":80,"wires":[["3e1bb2bf.64fcbe","b5fccbcd.0c8a18"]]},{"id":"62ccdb20.877394","type":"inject","z":"2b590643.985dca","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"*/1 6-22 * * *","once":false,"onceDelay":0.1,"x":110,"y":80,"wires":[["ebe667f7.be8e68","9d4f901a.924c3"]]},{"id":"98c69b90.8ee0d8","type":"debug","z":"2b590643.985dca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":810,"y":40,"wires":[]},{"id":"3e1bb2bf.64fcbe","type":"change","z":"2b590643.985dca","name":"\"Printing\"","rules":[{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"Printing","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Operational","fromt":"str","to":"Idle","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":40,"wires":[["98c69b90.8ee0d8"]]},{"id":"9f980072.eb5c7","type":"change","z":"2b590643.985dca","name":"\"on\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":200,"wires":[["54f09010.931e"]]},{"id":"9ba399e5.924398","type":"change","z":"2b590643.985dca","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The King roon 3 d printer is done!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":260,"wires":[["8c9af54f.4646a8"]]},{"id":"d77e3775.0a0ef8","type":"rbe","z":"2b590643.985dca","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":650,"y":200,"wires":[["9ba399e5.924398","9f980072.eb5c7"]]},{"id":"54f09010.931e","type":"api-call-service","z":"2b590643.985dca","name":"Office LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_on","entityId":"light.multisensor_light","data":"{ \"entity_id\":\"light.multisensor_light\", \"rgb_color\":[0,255,0] }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":200,"wires":[[]]},{"id":"ea39d675.7d1598","type":"inject","z":"2b590643.985dca","name":"Off","topic":"","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":300,"wires":[["a306ca3b.fc9f68"]]},{"id":"a306ca3b.fc9f68","type":"api-call-service","z":"2b590643.985dca","name":"Office LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_off","entityId":"light.multisensor_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":470,"y":300,"wires":[["f09b6b73.580ba8"]]},{"id":"f09b6b73.580ba8","type":"change","z":"2b590643.985dca","name":"Cleared","rules":[{"t":"set","p":"payload","pt":"msg","to":"Cleared","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":300,"wires":[[]]},{"id":"b5fccbcd.0c8a18","type":"debug","z":"2b590643.985dca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":510,"y":120,"wires":[]},{"id":"b1bc83ea.04471","type":"ha-wait-until","z":"8b414f68.37d25","name":"Is truck door open","server":"29d635fb.a91c9a","outputs":1,"entityId":"cover.truck_door","property":"state","comparator":"is","value":"open","valueType":"str","timeout":0,"timeoutUnits":"seconds","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":410,"y":1000,"wires":[["7d1c1534.9353ac"]]},{"id":"56a8d2a6.7a883c","type":"link in","z":"8b414f68.37d25","name":"Test truck door","links":[],"x":220,"y":1000,"wires":[["b1bc83ea.04471"]],"l":true},{"id":"7d1c1534.9353ac","type":"link out","z":"8b414f68.37d25","name":"Truck door result","links":[],"x":610,"y":1000,"wires":[],"l":true},{"id":"7afdaaa3.17f434","type":"server-state-changed","z":"73b5a3a7.e7bf5c","name":"Office Motion","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.office_motion","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":110,"y":100,"wires":[["ec6bde2f.772bc"]]},{"id":"5189806.ed3058","type":"stoptimer","z":"73b5a3a7.e7bf5c","duration":"20","units":"Minute","payloadtype":"num","payloadval":"0","name":"20min","x":470,"y":140,"wires":[["845a97f7.fadaa8"],[]]},{"id":"845a97f7.fadaa8","type":"api-call-service","z":"73b5a3a7.e7bf5c","name":"OFF","server":"29d635fb.a91c9a","version":1,"service_domain":"homeassistant","service":"turn_off","entityId":"light.office_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":930,"y":134,"wires":[[]]},{"id":"7f80fffe.05e01","type":"api-call-service","z":"73b5a3a7.e7bf5c","name":"ON","server":"29d635fb.a91c9a","version":1,"service_domain":"homeassistant","service":"turn_on","entityId":"light.office_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":930.1666526794434,"y":93.95236015319824,"wires":[[]]},{"id":"ec6bde2f.772bc","type":"switch","z":"73b5a3a7.e7bf5c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":100,"wires":[["5189806.ed3058","5a1daf94.93716"],["5189806.ed3058"]]},{"id":"5a1daf94.93716","type":"api-current-state","z":"73b5a3a7.e7bf5c","name":"Already On?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.office_light","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":668,"y":93,"wires":[[],["7f80fffe.05e01"]]},{"id":"82af77d.b190d88","type":"server-state-changed","z":"73b5a3a7.e7bf5c","name":"Workbench Motion","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.workbench_motion","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":110,"y":280,"wires":[["ec21dc52.2a4c5"]]},{"id":"334188c3.bab0d8","type":"stoptimer","z":"73b5a3a7.e7bf5c","duration":"20","units":"Minute","payloadtype":"num","payloadval":"0","name":"20min","x":470,"y":320,"wires":[["3ead360c.4dfada"],[]]},{"id":"3ead360c.4dfada","type":"api-call-service","z":"73b5a3a7.e7bf5c","name":"OFF","server":"29d635fb.a91c9a","version":"1","service_domain":"homeassistant","service":"turn_off","entityId":"group.Office","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":930,"y":340,"wires":[[]]},{"id":"fb87bfec.da87f","type":"api-call-service","z":"73b5a3a7.e7bf5c","name":"ON","server":"29d635fb.a91c9a","version":"1","service_domain":"homeassistant","service":"turn_on","entityId":"group.Office","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":930.1666526794434,"y":273.95236015319824,"wires":[[]]},{"id":"ec21dc52.2a4c5","type":"switch","z":"73b5a3a7.e7bf5c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":280,"wires":[["334188c3.bab0d8","4732f6a1.e20ae8"],["334188c3.bab0d8"]]},{"id":"4732f6a1.e20ae8","type":"api-current-state","z":"73b5a3a7.e7bf5c","name":"Already On?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.inside_garage_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":668,"y":273,"wires":[[],["fb87bfec.da87f"]]},{"id":"e9aa5285.88b18","type":"chatbot-authorized","z":"81799776.d66798","x":310,"y":60,"wires":[["ee07cdd5.8454e","f61d7a13.c7cf48"],["713dc71.7f20738"]]},{"id":"ea151e89.31c69","type":"chatbot-telegram-receive","z":"81799776.d66798","bot":"f0f3ea5.90dd918","botProduction":"f0f3ea5.90dd918","x":110,"y":60,"wires":[["e9aa5285.88b18","f2a39bf8.eaef38"]]},{"id":"2c7b5460.5bb80c","type":"chatbot-command","z":"81799776.d66798","name":"","command":"/m","x":290,"y":320,"wires":[["f61d7a13.c7cf48"]]},{"id":"132b8dab.781cf2","type":"chatbot-command","z":"81799776.d66798","name":"","command":"/stop","x":290,"y":560,"wires":[["2ea31120.beb68e"]]},{"id":"713dc71.7f20738","type":"chatbot-message","z":"81799776.d66798","name":"Unauthorized","message":[{"message":"Unauthorized access!"}],"answer":false,"silent":false,"x":550,"y":80,"wires":[["f99b57ca.8483b8","f8d02fd9.d818"]]},{"id":"f8d02fd9.d818","type":"chatbot-telegram-send","z":"81799776.d66798","bot":"f0f3ea5.90dd918","botProduction":"f0f3ea5.90dd918","track":true,"passThrough":true,"outputs":1,"x":790,"y":180,"wires":[["acc8786e.1f95a8"]]},{"id":"f61d7a13.c7cf48","type":"chatbot-inline-buttons","z":"81799776.d66798","name":"Main menu","buttons":[{"type":"postback","label":"Arm","value":"/as","answer":"Alarm is armed!","alert":false,"style":"default"},{"type":"postback","label":"Disarm","value":"/d","answer":"Alarm is disarmed!","alert":false,"style":"default"},{"type":"newline"},{"type":"postback","label":"Just stop","value":"/stop","answer":"All right","alert":false,"style":"default"}],"message":"❓ Please enter your choice {{firstName}}:","x":490,"y":320,"wires":[["ca654db0.394ee"]]},{"id":"f2a39bf8.eaef38","type":"debug","z":"81799776.d66798","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":290,"y":120,"wires":[]},{"id":"ee07cdd5.8454e","type":"debug","z":"81799776.d66798","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":970,"y":40,"wires":[]},{"id":"f99b57ca.8483b8","type":"debug","z":"81799776.d66798","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":970,"y":100,"wires":[]},{"id":"913de10d.b1a3e","type":"chatbot-command","z":"81799776.d66798","name":"","command":"/as","x":290,"y":380,"wires":[["197f5910.ad0d47"]]},{"id":"903e6df1.a1a01","type":"chatbot-command","z":"81799776.d66798","name":"","command":"/aa","x":290,"y":440,"wires":[["b0c74cc6.a56e2"]]},{"id":"142d082b.48dbd8","type":"chatbot-command","z":"81799776.d66798","name":"","command":"/d","x":290,"y":500,"wires":[["ca9366b2.efc918"]]},{"id":"8ab1581d.ba4e38","type":"chatbot-message","z":"81799776.d66798","name":"","message":[{"message":"Whatever, dude."}],"answer":false,"silent":false,"x":630,"y":560,"wires":[["ca654db0.394ee"]]},{"id":"197f5910.ad0d47","type":"api-call-service","z":"81799776.d66798","name":"Turn on IKEA light","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.color_light","data":"{\"entity_id\":\"light.ikea_light\",\"color_name\":\"green\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":450,"y":380,"wires":[["ca654db0.394ee"]]},{"id":"ca9366b2.efc918","type":"api-call-service","z":"81799776.d66798","name":"Turn on IKEA light","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.color_light","data":"{\"color_name\":\"red\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":450,"y":500,"wires":[["ca654db0.394ee"]]},{"id":"b0c74cc6.a56e2","type":"api-call-service","z":"81799776.d66798","name":"Turn on IKEA light","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.color_light","data":"{\"entity_id\":\"light.ikea_light\",\"color_name\":\"blue\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":450,"y":440,"wires":[["ca654db0.394ee"]]},{"id":"2ae956a2.4f9a4a","type":"link in","z":"81799776.d66798","name":"Telegram sender input","links":["ca654db0.394ee","d3746879.14e5b8"],"x":560,"y":180,"wires":[["f8d02fd9.d818"]],"l":true},{"id":"acc8786e.1f95a8","type":"link out","z":"81799776.d66798","name":"Telegram sender output","links":["2a3dadf4.475db2","48a854d6.e83c9c","622d7e6f.58e43","6872b49d.0be5fc","6b30a0e1.28a9f","79543e63.103f9","7f4d71f3.58ea9"],"x":1030,"y":180,"wires":[],"l":true},{"id":"7f4d71f3.58ea9","type":"link in","z":"81799776.d66798","name":"From Telegram sender","links":["acc8786e.1f95a8"],"x":120,"y":320,"wires":[["2c7b5460.5bb80c"]],"l":true},{"id":"2a3dadf4.475db2","type":"link in","z":"81799776.d66798","name":"From Telegram sender","links":["acc8786e.1f95a8"],"x":120,"y":380,"wires":[["913de10d.b1a3e"]],"l":true},{"id":"622d7e6f.58e43","type":"link in","z":"81799776.d66798","name":"From Telegram sender","links":["acc8786e.1f95a8"],"x":120,"y":440,"wires":[["903e6df1.a1a01"]],"l":true},{"id":"79543e63.103f9","type":"link in","z":"81799776.d66798","name":"From Telegram sender","links":["acc8786e.1f95a8"],"x":120,"y":500,"wires":[["142d082b.48dbd8"]],"l":true},{"id":"6b30a0e1.28a9f","type":"link in","z":"81799776.d66798","name":"From Telegram sender","links":["acc8786e.1f95a8"],"x":120,"y":560,"wires":[["132b8dab.781cf2"]],"l":true},{"id":"ca654db0.394ee","type":"link out","z":"81799776.d66798","name":"To Telegram sender","links":["2ae956a2.4f9a4a"],"x":910,"y":420,"wires":[],"l":true},{"id":"2ea31120.beb68e","type":"api-call-service","z":"81799776.d66798","name":"Turn off IKEA light","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.color_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":450,"y":560,"wires":[["8ab1581d.ba4e38"]]},{"id":"1a6b4bfe.405f24","type":"chatbot-image","z":"81799776.d66798","name":"Snapshot","filename":"","image":"http://192.168.0.108/snap.jpeg","caption":"","x":780,"y":620,"wires":[["ca654db0.394ee"]]},{"id":"3c23c012.9add6","type":"chatbot-command","z":"81799776.d66798","name":"","command":"/snap","x":290,"y":620,"wires":[["c5388b23.0e72a8","329e4b40.75a5d4"]]},{"id":"6872b49d.0be5fc","type":"link in","z":"81799776.d66798","name":"From Telegram sender","links":["acc8786e.1f95a8"],"x":120,"y":620,"wires":[["3c23c012.9add6"]],"l":true},{"id":"c5388b23.0e72a8","type":"chatbot-waiting","z":"81799776.d66798","waitingType":"upload_photo","x":420,"y":660,"wires":[["1a6b4bfe.405f24"]]},{"id":"329e4b40.75a5d4","type":"change","z":"81799776.d66798","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"http://192.168.0.108/snap.jpeg","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":620,"wires":[["3174758e.74281a"]]},{"id":"3174758e.74281a","type":"http request","z":"81799776.d66798","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","persist":false,"authType":"","x":610,"y":620,"wires":[["1a6b4bfe.405f24"]]},{"id":"ba534f73.b88d2","type":"chatbot-image","z":"81799776.d66798","name":"Snapshot","filename":"","image":"http://192.168.0.105/doors.jpg","caption":"","x":780,"y":700,"wires":[["ca654db0.394ee"]]},{"id":"99e37825.ee2b48","type":"chatbot-command","z":"81799776.d66798","name":"","command":"/doors","x":290,"y":700,"wires":[["b4416aca.601ba8","b858e089.aae8b"]]},{"id":"48a854d6.e83c9c","type":"link in","z":"81799776.d66798","name":"From Telegram sender","links":["acc8786e.1f95a8"],"x":120,"y":700,"wires":[["99e37825.ee2b48"]],"l":true},{"id":"b4416aca.601ba8","type":"chatbot-waiting","z":"81799776.d66798","waitingType":"upload_photo","x":440,"y":740,"wires":[["ba534f73.b88d2"]]},{"id":"b858e089.aae8b","type":"http request","z":"81799776.d66798","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.0.105/cgi-bin/zm/zms?mode=single&monitor=4&user=admin&pass=admin  -O doors.jpg","tls":"","persist":false,"proxy":"","authType":"","x":570,"y":700,"wires":[["ba534f73.b88d2"]]},{"id":"cebb9544.3529b8","type":"chatbot-message","z":"838b375b.a3fcd8","name":"","message":[{"message":"The dryer is done, man."}],"answer":false,"silent":false,"x":810,"y":380,"wires":[["d3746879.14e5b8"]]},{"id":"d3746879.14e5b8","type":"link out","z":"838b375b.a3fcd8","name":"To Telegram Notifications","links":["2ae956a2.4f9a4a"],"x":1010,"y":380,"wires":[],"l":true},{"id":"48869aab.4a4be4","type":"inject","z":"838b375b.a3fcd8","name":"","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":670,"y":380,"wires":[["cebb9544.3529b8"]]},{"id":"a7af6679.140318","type":"chatbot-message","z":"81799776.d66798","name":"Fallback message","message":[{"message":"Fallback message"}],"answer":true,"silent":false,"x":690,"y":800,"wires":[["ca654db0.394ee","ddb10c65.535d"]]},{"id":"ddb10c65.535d","type":"debug","z":"81799776.d66798","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":910,"y":800,"wires":[]},{"id":"a662cc90.48ed2","type":"debug","z":"81799776.d66798","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":770,"y":880,"wires":[]},{"id":"481fa19b.b414c","type":"function","z":"81799776.d66798","name":"The thing worked!","func":"msg.payload = 'The thing worked!';\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":800,"wires":[["a7af6679.140318","a662cc90.48ed2"]]},{"id":"3ef25da1.df9cd2","type":"inject","z":"81799776.d66798","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":800,"wires":[["481fa19b.b414c"]]},{"id":"8c7d01f5.95106","type":"api-call-service","z":"81799776.d66798","name":"","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"notify","service":"","entityId":"notify.telegram","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":1060,"wires":[["44577afd.9d44f4"]]},{"id":"b65aa809.f4ffc8","type":"inject","z":"81799776.d66798","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":1060,"wires":[["8c7d01f5.95106"]]},{"id":"44577afd.9d44f4","type":"debug","z":"81799776.d66798","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":850,"y":1060,"wires":[]},{"id":"7e4cdf19.049d1","type":"server-state-changed","z":"b7987fdf.32542","name":"Front door opened","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.front_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":200,"wires":[["a69229f.99295d8"]]},{"id":"1715645b.06a3ec","type":"server-state-changed","z":"b7987fdf.32542","name":"Kitchen door opened","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.kitchen_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":260,"wires":[["85622097.c7597"]]},{"id":"8195f1d2.17668","type":"server-state-changed","z":"b7987fdf.32542","name":"Back door opened","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.back_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":320,"wires":[["b7ccfe71.d7aab"]]},{"id":"c4ad38a4.971f58","type":"server-state-changed","z":"b7987fdf.32542","name":"Shop door opened","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.garage_fire_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":380,"wires":[["993d1957.8e8078"]]},{"id":"a69229f.99295d8","type":"change","z":"b7987fdf.32542","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The front door has been opened.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":200,"wires":[["86ad3982.16cc58"]]},{"id":"85622097.c7597","type":"change","z":"b7987fdf.32542","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The kitchen door has been opened.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":260,"wires":[["86ad3982.16cc58"]]},{"id":"b7ccfe71.d7aab","type":"change","z":"b7987fdf.32542","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The back door has been opened.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":320,"wires":[["86ad3982.16cc58"]]},{"id":"993d1957.8e8078","type":"change","z":"b7987fdf.32542","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The garage door has been opened.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":380,"wires":[["86ad3982.16cc58"]]},{"id":"f9489d28.e8f1f","type":"inject","z":"b7987fdf.32542","name":"The kitchen door has been ope ned.","topic":"","payload":"The kitchen door has been opend.","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":760,"y":100,"wires":[["86ad3982.16cc58"]]},{"id":"8e7c6918.5a86f8","type":"debug","z":"8b414f68.37d25","name":"Not home","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":640,"y":900,"wires":[]},{"id":"878457ea.e95d88","type":"debug","z":"8b414f68.37d25","name":"Home Status","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":550,"y":1440,"wires":[]},{"id":"c9fc0980.3e6b38","type":"trigger-state","z":"8b414f68.37d25","name":"Jake Set from away to home","server":"29d635fb.a91c9a","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.jake_person","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"bm9r4ws0w3m","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Away"},{"id":"qjtl0dkeg7k","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Home"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":180,"y":1360,"wires":[["878457ea.e95d88","8e36bdf6.3c604","70c3d829.64b588","47502713.6d96e8"],[]]},{"id":"483c620d.3ffa6c","type":"debug","z":"8b414f68.37d25","name":"Home Status","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":570,"y":1720,"wires":[]},{"id":"a9745051.bf82","type":"trigger-state","z":"8b414f68.37d25","name":"Jake Set to Away","server":"29d635fb.a91c9a","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.jake_person","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":210,"y":1580,"wires":[[],[]]},{"id":"dda79c7a.0215b","type":"api-call-service","z":"8b414f68.37d25","name":"Office LED Red","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.multisensor_light","data":"{ \"entity_id\":\"light.multisensor_light\", \"color_name\":\"red\" }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":1600,"wires":[["604e3d92.c020a4"]]},{"id":"8e36bdf6.3c604","type":"api-call-service","z":"8b414f68.37d25","name":"Office LED Green","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.multisensor_light","data":"{ \"entity_id\":\"light.multisensor_light\", \"color_name\":\"green\" }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":1320,"wires":[["33edd537.d1b83a"]]},{"id":"c8031337.5c339","type":"api-current-state","z":"8b414f68.37d25","name":"Is Torch on","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.torch","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":550,"y":1660,"wires":[["acaa45d5.92e628"],[]]},{"id":"acaa45d5.92e628","type":"api-call-service","z":"8b414f68.37d25","name":"Turn off Torch","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.torch","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":740,"y":1660,"wires":[[]]},{"id":"70c3d829.64b588","type":"api-current-state","z":"8b414f68.37d25","name":"Is Torch on","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.torch","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":530,"y":1380,"wires":[["552b4913.304a38"],[]]},{"id":"552b4913.304a38","type":"api-call-service","z":"8b414f68.37d25","name":"Turn on Torch","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.torch","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":720,"y":1380,"wires":[[]]},{"id":"8bd85f8b.66c4e","type":"debug","z":"8b414f68.37d25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":990,"y":1540,"wires":[]},{"id":"47502713.6d96e8","type":"function","z":"8b414f68.37d25","name":"home or not","func":"var message=msg.payload;\nvar newmsg={payload: \"Jake is \" + message};\nreturn newmsg;","outputs":1,"noerr":0,"x":750,"y":1500,"wires":[["8bd85f8b.66c4e","c5ea0c48.80504"]]},{"id":"fc1ed461.317678","type":"comment","z":"8b414f68.37d25","name":"Take these actions when Jacob returns home","info":"","x":270,"y":1280,"wires":[]},{"id":"6391f7b2.5b20b8","type":"comment","z":"8b414f68.37d25","name":"Take these actions when Jacob is out of the house","info":"","x":270,"y":1540,"wires":[]},{"id":"e03c42ff.8621a","type":"debug","z":"8b414f68.37d25","name":"Home Status","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":570,"y":2120,"wires":[]},{"id":"2c90a35f.4e1f4c","type":"trigger-state","z":"8b414f68.37d25","name":"Jake Set to Traveling","server":"29d635fb.a91c9a","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.traveling","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"px26liryezg","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"not_home"},{"id":"4jw688m99sr","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":240,"y":1940,"wires":[["e03c42ff.8621a","f6a1588.7dbada8","c53e29cd.c3dfa8","f98c9595.19ce48"],[]]},{"id":"f6a1588.7dbada8","type":"api-call-service","z":"8b414f68.37d25","name":"Office LED Red","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.multisensor_light","data":"{ \"entity_id\":\"light.multisensor_light\", \"color_name\":\"red\" }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":2000,"wires":[["65445f88.cb9a1"]]},{"id":"c53e29cd.c3dfa8","type":"api-current-state","z":"8b414f68.37d25","name":"Is Coffee pot on?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.coffee_pot","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":570,"y":2060,"wires":[["9a5cd4a0.76bf08"],[]]},{"id":"9a5cd4a0.76bf08","type":"api-call-service","z":"8b414f68.37d25","name":"Turn off coffee pot because I'm not home","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.coffee_pot","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":860,"y":2060,"wires":[[]]},{"id":"a959f5ec.ccf428","type":"comment","z":"8b414f68.37d25","name":"Take these actions when Jacob is out of the house","info":"","x":270,"y":1780,"wires":[]},{"id":"f98c9595.19ce48","type":"change","z":"8b414f68.37d25","name":"Out of town","rules":[{"t":"set","p":"payload","pt":"msg","to":"out of town","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1940,"wires":[["47502713.6d96e8"]]},{"id":"9ab38b73.729ab8","type":"trigger-state","z":"8b414f68.37d25","name":"Jake Set from traveling to home","server":"29d635fb.a91c9a","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.traveling","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"ne9zwuar95","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"},{"id":"r4tn7b1r11q","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"not_home"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":230,"y":1840,"wires":[["47502713.6d96e8","8e36bdf6.3c604"],[]]},{"id":"33edd537.d1b83a","type":"delay","z":"8b414f68.37d25","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":740,"y":1320,"wires":[["3a9cd982.e9a3e6"]]},{"id":"604e3d92.c020a4","type":"trigger","z":"8b414f68.37d25","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"5","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":740,"y":1600,"wires":[["9bc0b991.2b3138"]]},{"id":"9bc0b991.2b3138","type":"api-call-service","z":"8b414f68.37d25","name":"Office LED off","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.multisensor_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":1600,"wires":[[]]},{"id":"3a9cd982.e9a3e6","type":"api-call-service","z":"8b414f68.37d25","name":"Office LED off","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.multisensor_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":1320,"wires":[[]]},{"id":"65445f88.cb9a1","type":"trigger","z":"8b414f68.37d25","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"5","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":760,"y":2000,"wires":[["176c5292.528a7d"]]},{"id":"176c5292.528a7d","type":"api-call-service","z":"8b414f68.37d25","name":"Office LED off","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.multisensor_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":940,"y":2000,"wires":[[]]},{"id":"d7bd5b3.15c09a8","type":"comment","z":"5e27b596.12bbbc","name":"*******************************   Verbal reminder at 8 PM of trash can needing to go out   *******************************","info":"","x":570,"y":323,"wires":[]},{"id":"ee7db16a.0227","type":"comment","z":"5e27b596.12bbbc","name":"*******************************   Tell me what is on the calendar tomorrow every day at 20:15 PM   *******************************","info":"","x":600,"y":680,"wires":[]},{"id":"a347d184.99067","type":"api-current-state","z":"eac2df63.5cf68","name":"State of charge","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.soc","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":260,"y":620,"wires":[["21bba7a0.da3268"]]},{"id":"4d01f628.601228","type":"inject","z":"eac2df63.5cf68","name":"At 8:55 PM","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"55 20 * * *","once":false,"onceDelay":0.1,"x":130,"y":500,"wires":[["6fb4d0a8.9e511"]]},{"id":"21bba7a0.da3268","type":"switch","z":"eac2df63.5cf68","name":"Less than 90%","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"90","vt":"num"},{"t":"gt","v":"99","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":440,"y":620,"wires":[["4f934fa.9e2f3b"],["40777351.0904fc"]]},{"id":"4f934fa.9e2f3b","type":"api-current-state","z":"eac2df63.5cf68","name":"Charging?","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.charging","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":610,"y":600,"wires":[["ecaa8d86.5c176"]]},{"id":"ecaa8d86.5c176","type":"switch","z":"eac2df63.5cf68","name":"Yes or No","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"no","vt":"str"},{"t":"eq","v":"yes","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":760,"y":600,"wires":[["b5343234.1e01"],["9bb7e2de.4dfa8"]]},{"id":"40777351.0904fc","type":"change","z":"eac2df63.5cf68","name":"\"Car is charged\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"The car is already charged","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":660,"wires":[["bc6a6bfd.bfa678"]]},{"id":"b5343234.1e01","type":"change","z":"eac2df63.5cf68","name":"\"The car has not been charged\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"The car has not been charged","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":540,"wires":[["bc6a6bfd.bfa678"]]},{"id":"9bb7e2de.4dfa8","type":"change","z":"eac2df63.5cf68","name":"\"Car is being charged\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Car is being charged","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":600,"wires":[["bc6a6bfd.bfa678"]]},{"id":"6ffb88fd.597488","type":"comment","z":"eac2df63.5cf68","name":"****************   Remind me on the phone if the car is not charged   ****************","info":"","x":610,"y":500,"wires":[]},{"id":"e042f7c.11d4108","type":"mqtt out","z":"cc5ab19e.7bb6f","name":"Say it on OnePlus","topic":"zanzito/oneplus5z/say","qos":"2","retain":"false","broker":"9afb58a1.205718","x":190,"y":80,"wires":[]},{"id":"723af41d.14c3fc","type":"function","z":"ecafd5c5.2d8028","name":"Say whatever is input to this","func":"var payload=msg.payload;\nvar speak = msg.payload.speak\n\nmsg.payload = {\n    data: {\n        message: payload,\n        \n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":80,"wires":[["daf72ed8.125f7"]]},{"id":"f65d3ff4.1b76f","type":"function","z":"ed60b07d.9ec52","name":"Say whatever is input to this","func":"var payload=msg.payload;\nvar speak = msg.payload.speak\n\nmsg.payload = {\n    data: {\n        message: payload,\n        \n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":80,"wires":[["fc4705ee.d6cfd8"]]},{"id":"ba493f7d.67ab","type":"comment","z":"215b943e.474c3c","name":"****************   Email template example   ****************","info":"","x":240,"y":160,"wires":[]},{"id":"46c9fa16.74ef74","type":"moment","z":"e9c46f27.b8a08","name":"Current Time","topic":"","input":"payload","inputType":"msg","inTz":"America/New_York","adjAmount":"0","adjType":"minutes","adjDir":"subtract","format":"ddd, MMM Do HH:mm","locale":"C","output":"payload","outputType":"msg","outTz":"America/New_York","x":510,"y":440,"wires":[["ca40be8e.72247"]]},{"id":"a19cecba.97121","type":"change","z":"e9c46f27.b8a08","name":"Make timestamp","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":420,"wires":[["46c9fa16.74ef74"]]},{"id":"8d2938d5.6b92b8","type":"influxdb in","z":"e9c46f27.b8a08","influxdb":"60236f0c.f6d7f","name":"meep","query":"SELECT sum(count(\"value\")) FROM \"autogen\".\"Poops\" WHERE (\"entity_id\" = 'crap_o_matic')","rawOutput":false,"precision":"","retentionPolicy":"","x":550,"y":740,"wires":[["7a546aae.48fd04"]]},{"id":"7a546aae.48fd04","type":"debug","z":"e9c46f27.b8a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":730,"y":740,"wires":[]},{"id":"37fca781.cb2008","type":"inject","z":"e9c46f27.b8a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":740,"wires":[["8d2938d5.6b92b8"]]},{"id":"1706e4b6.45179b","type":"api-current-state","z":"e9c46f27.b8a08","name":"Cat?","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.cat_detected","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":170,"y":100,"wires":[[]]},{"id":"d7005df0.1d1ce","type":"inject","z":"e9c46f27.b8a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":40,"wires":[["1706e4b6.45179b"]]},{"id":"d9c54833.ad5d68","type":"debug","z":"e9c46f27.b8a08","name":"count","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":990,"y":1860,"wires":[]},{"id":"26bd8651.ca6c2a","type":"counter","z":"e9c46f27.b8a08","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":1,"x":800,"y":1840,"wires":[["62fbb13b.a3062","d9c54833.ad5d68"]]},{"id":"62fbb13b.a3062","type":"mqtt out","z":"e9c46f27.b8a08","name":"Poop count","topic":"poop/count","qos":"","retain":"","broker":"9afb58a1.205718","x":1010,"y":1800,"wires":[]},{"id":"ed44a352.18276","type":"function","z":"e9c46f27.b8a08","name":"Increment by 1","func":"msg.increment = 1;\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":1800,"wires":[["26bd8651.ca6c2a"]]},{"id":"b493d476.a47018","type":"counter","z":"e9c46f27.b8a08","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":"2","x":580,"y":180,"wires":[["c93a8ad7.5d9828","91802bd5.911048"],[]]},{"id":"4986ee21.59e49","type":"server-state-changed","z":"e9c46f27.b8a08","name":"Drawer","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.drawer","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":317.0173645019531,"y":90.01041412353516,"wires":[[],["5bc680eb.7bd61"]]},{"id":"a3dedebd.f356","type":"inject","z":"5e27b596.12bbbc","name":"Fan speed trigger","topic":"3","payload":"","payloadType":"num","repeat":"","crontab":"59 23 * * *","once":false,"onceDelay":0.1,"x":510,"y":1440,"wires":[["be9b2e6a.3b29a"]]},{"id":"29b95788.986ad8","type":"comment","z":"5e27b596.12bbbc","name":"*******************************   Set bedroom fan to high at midnight   *******************************","info":"","x":613,"y":1400,"wires":[]},{"id":"be9b2e6a.3b29a","type":"api-call-service","z":"5e27b596.12bbbc","name":"Bedroom Fan on","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"fan","service":"turn_on","entityId":"fan.master_bedroom_fan","data":"{\"speed\":\"high\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":813,"y":1440,"wires":[[]]},{"id":"737c33c9.4886fc","type":"influxdb in","z":"e9c46f27.b8a08","influxdb":"60236f0c.f6d7f","name":"time query","query":"select * from test;","rawOutput":false,"precision":"","retentionPolicy":"","x":490,"y":1060,"wires":[["ac946769.3c9698"]]},{"id":"6b9ccd4d.8bcf34","type":"inject","z":"e9c46f27.b8a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":339,"y":1060,"wires":[["737c33c9.4886fc"]]},{"id":"ac946769.3c9698","type":"debug","z":"e9c46f27.b8a08","name":"","active":true,"console":"false","complete":"false","x":672,"y":1060,"wires":[]},{"id":"ddacc435.6a6ea8","type":"influxdb out","z":"e9c46f27.b8a08","influxdb":"60236f0c.f6d7f","name":"","measurement":"test","precision":"","retentionPolicy":"","x":730,"y":1140,"wires":[]},{"id":"5c566ea.f634c9","type":"function","z":"e9c46f27.b8a08","name":"single value","func":"msg.payload = Math.random()*10;\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1140,"wires":[["ddacc435.6a6ea8"]]},{"id":"b668e8dc.4be378","type":"inject","z":"e9c46f27.b8a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":260,"y":1140,"wires":[["5c566ea.f634c9"]]},{"id":"9d09625d.ac61c","type":"inject","z":"e9c46f27.b8a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":260,"y":1220,"wires":[["8e7ba54a.a5f908"]]},{"id":"8e7ba54a.a5f908","type":"function","z":"e9c46f27.b8a08","name":"simple query","func":"msg.query=\"select * from test;\";\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1220,"wires":[["561c168b.8793e8"]]},{"id":"561c168b.8793e8","type":"influxdb in","z":"e9c46f27.b8a08","influxdb":"60236f0c.f6d7f","name":"time query","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":583,"y":1220,"wires":[["be7906cc.7f3948"]]},{"id":"be7906cc.7f3948","type":"debug","z":"e9c46f27.b8a08","name":"","active":true,"console":"false","complete":"false","x":741,"y":1220,"wires":[]},{"id":"481ff294.efdb4c","type":"delay","z":"5e27b596.12bbbc","name":"","pauseType":"delay","timeout":"25","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1000,"y":1260,"wires":[["131b6873.9cb668"]]},{"id":"9d4f901a.924c3","type":"api-current-state","z":"2b590643.985dca","name":"Kingroon Bed Temperature","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.octoprint_actual_bed_temp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":360,"y":380,"wires":[["8fbf1f40.90e67"]]},{"id":"b2e0ca6a.2c67e8","type":"debug","z":"2b590643.985dca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":850,"y":340,"wires":[]},{"id":"8fbf1f40.90e67","type":"switch","z":"2b590643.985dca","name":"Below 100 degrees","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"100","vt":"num"},{"t":"lt","v":"99","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":380,"wires":[["b2e0ca6a.2c67e8"],["d0131165.f47e7"]]},{"id":"ed4e77a0.362988","type":"change","z":"2b590643.985dca","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The King roon print bed has cooled!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":400,"wires":[[]]},{"id":"d0131165.f47e7","type":"rbe","z":"2b590643.985dca","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":750,"y":400,"wires":[["ed4e77a0.362988"]]},{"id":"11e9e49f.74ddeb","type":"change","z":"235eedcf.c34822","name":"\"There is mail\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"There is mail","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":260,"wires":[["295766c9.8c9efa"]]},{"id":"33591cb1.67cfd4","type":"inject","z":"235eedcf.c34822","name":"Say something","topic":"","payload":"something","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":440,"y":140,"wires":[["f08e415a.e09d"]]},{"id":"add3d835.f23728","type":"server-state-changed","z":"235eedcf.c34822","name":"Mailbox triggered","server":"29d635fb.a91c9a","version":1,"entityidfilter":"binary_sensor.mailbox","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":160,"y":260,"wires":[["11e9e49f.74ddeb"]]},{"id":"1483aafd.ae8b65","type":"function","z":"2b590643.985dca","name":"Was just done","func":"if(msg.data !== null && msg.data.old_state !== null) {\nif(msg.data.old_state.state === \"Printing\") {\nreturn msg\n}\n}\nreturn null;","outputs":1,"noerr":0,"x":500,"y":700,"wires":[["7cb38da2.4fead4"]]},{"id":"515f92d5.75284c","type":"server-state-changed","z":"2b590643.985dca","name":"Ultimaker state","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.ultimaker_current_state","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":320,"y":700,"wires":[["1483aafd.ae8b65"]]},{"id":"75fed860.cf8688","type":"api-current-state","z":"2b590643.985dca","name":"Ultimaker","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.ultimaker_current_state","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":260,"y":580,"wires":[["883b9ffd.dde1","56f4c64d.4fdc18"]]},{"id":"574dbce8.827a74","type":"inject","z":"2b590643.985dca","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"*/1 6-22 * * *","once":false,"onceDelay":0.1,"x":110,"y":580,"wires":[["75fed860.cf8688","9e4e6df7.e9447"]]},{"id":"21c51607.cb027a","type":"debug","z":"2b590643.985dca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":810,"y":540,"wires":[]},{"id":"883b9ffd.dde1","type":"change","z":"2b590643.985dca","name":"\"Printing\"","rules":[{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"Printing","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Operational","fromt":"str","to":"Idle","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":540,"wires":[["21c51607.cb027a"]]},{"id":"d6b1cafe.c77de8","type":"change","z":"2b590643.985dca","name":"\"on\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":700,"wires":[["3cafdf5.6636c2"]]},{"id":"cda292f5.fa69","type":"change","z":"2b590643.985dca","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The Ultimaker 3 d printer is done!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":760,"wires":[["e8bc6436.3abdd8"]]},{"id":"7cb38da2.4fead4","type":"rbe","z":"2b590643.985dca","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":650,"y":700,"wires":[["cda292f5.fa69","d6b1cafe.c77de8"]]},{"id":"3cafdf5.6636c2","type":"api-call-service","z":"2b590643.985dca","name":"Office LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_on","entityId":"light.multisensor_light","data":"{ \"entity_id\":\"light.multisensor_light\", \"rgb_color\":[0,255,0] }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":700,"wires":[[]]},{"id":"7d5511f8.29f14","type":"inject","z":"2b590643.985dca","name":"Off","topic":"","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":800,"wires":[["43dec67b.3e4b88"]]},{"id":"43dec67b.3e4b88","type":"api-call-service","z":"2b590643.985dca","name":"Office LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_off","entityId":"light.multisensor_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":470,"y":800,"wires":[["3379501c.b1b83"]]},{"id":"3379501c.b1b83","type":"change","z":"2b590643.985dca","name":"Cleared","rules":[{"t":"set","p":"payload","pt":"msg","to":"Cleared","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":800,"wires":[[]]},{"id":"56f4c64d.4fdc18","type":"debug","z":"2b590643.985dca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":510,"y":620,"wires":[]},{"id":"9e4e6df7.e9447","type":"api-current-state","z":"2b590643.985dca","name":"Ultimaker Bed Temperature","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.ultimaker_actual_bed_temp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":360,"y":880,"wires":[["61d80d65.efdc54"]]},{"id":"4d3ed30b.bafabc","type":"debug","z":"2b590643.985dca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":850,"y":840,"wires":[]},{"id":"61d80d65.efdc54","type":"switch","z":"2b590643.985dca","name":"Below 100 degrees","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"100","vt":"num"},{"t":"lt","v":"99","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":880,"wires":[["4d3ed30b.bafabc"],["4c3d7601.d668f8"]]},{"id":"2d740e03.f817f2","type":"change","z":"2b590643.985dca","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The Ultimaker print bed has cooled!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":900,"wires":[[]]},{"id":"4c3d7601.d668f8","type":"rbe","z":"2b590643.985dca","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":750,"y":900,"wires":[["2d740e03.f817f2"]]},{"id":"70335e23.83f9c","type":"function","z":"2b590643.985dca","name":"Was just done","func":"if(msg.data !== null && msg.data.old_state !== null) {\nif(msg.data.old_state.state === \"Printing\") {\nreturn msg\n}\n}\nreturn null;","outputs":1,"noerr":0,"x":500,"y":1220,"wires":[["68ea731c.92dd2c"]]},{"id":"cc95662.81f7598","type":"server-state-changed","z":"2b590643.985dca","name":"Sidewinder state","server":"29d635fb.a91c9a","version":1,"entityidfilter":"sensor.artillery_sidewinder_current_state","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":320,"y":1220,"wires":[["70335e23.83f9c"]]},{"id":"c934256b.d2f278","type":"api-current-state","z":"2b590643.985dca","name":"Sidewinder","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.artillery_sidewinder_current_state","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":270,"y":1100,"wires":[["5fefff24.be646","230da6e.05abf5a"]]},{"id":"2d0ed7d2.ba7d48","type":"inject","z":"2b590643.985dca","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"*/1 6-22 * * *","once":false,"onceDelay":0.1,"x":110,"y":1100,"wires":[["c934256b.d2f278","c891fa68.b44428"]]},{"id":"e0ee6409.c8dad8","type":"debug","z":"2b590643.985dca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":810,"y":1060,"wires":[]},{"id":"5fefff24.be646","type":"change","z":"2b590643.985dca","name":"\"Printing\"","rules":[{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"Printing","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Operational","fromt":"str","to":"Idle","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1060,"wires":[["e0ee6409.c8dad8"]]},{"id":"d389b65.6587148","type":"change","z":"2b590643.985dca","name":"\"on\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":1220,"wires":[["ce443e42.0521e"]]},{"id":"702043d0.ee49ec","type":"change","z":"2b590643.985dca","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The Sidewinder 3 d printer is done!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":1280,"wires":[["5a63b161.de5a5"]]},{"id":"68ea731c.92dd2c","type":"rbe","z":"2b590643.985dca","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":650,"y":1220,"wires":[["702043d0.ee49ec","d389b65.6587148"]]},{"id":"ce443e42.0521e","type":"api-call-service","z":"2b590643.985dca","name":"Office LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_on","entityId":"light.multisensor_light","data":"{ \"entity_id\":\"light.multisensor_light\", \"rgb_color\":[0,255,0] }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":1220,"wires":[[]]},{"id":"95bd01bb.e768e","type":"inject","z":"2b590643.985dca","name":"Off","topic":"","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":1320,"wires":[["ca2c1b23.dfe5e8"]]},{"id":"ca2c1b23.dfe5e8","type":"api-call-service","z":"2b590643.985dca","name":"Office LED","server":"29d635fb.a91c9a","version":1,"service_domain":"light","service":"turn_off","entityId":"light.multisensor_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":470,"y":1320,"wires":[["fe9f3542.1d6108"]]},{"id":"fe9f3542.1d6108","type":"change","z":"2b590643.985dca","name":"Cleared","rules":[{"t":"set","p":"payload","pt":"msg","to":"Cleared","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":1320,"wires":[[]]},{"id":"230da6e.05abf5a","type":"debug","z":"2b590643.985dca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":510,"y":1140,"wires":[]},{"id":"c891fa68.b44428","type":"api-current-state","z":"2b590643.985dca","name":"Sidewinder Bed Temperature","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.artillery_sidewinder_actual_bed_temp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":360,"y":1400,"wires":[["22445ef0.a38d52"]]},{"id":"9d3766af.8f1028","type":"debug","z":"2b590643.985dca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":850,"y":1360,"wires":[]},{"id":"22445ef0.a38d52","type":"switch","z":"2b590643.985dca","name":"Below 100 degrees","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"100","vt":"num"},{"t":"lt","v":"99","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":1400,"wires":[["9d3766af.8f1028"],["874efb7e.c4f6d8"]]},{"id":"1a2c9b4b.a5ccd5","type":"change","z":"2b590643.985dca","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"The Sidewinder print bed has cooled!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":1420,"wires":[[]]},{"id":"874efb7e.c4f6d8","type":"rbe","z":"2b590643.985dca","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":750,"y":1420,"wires":[["1a2c9b4b.a5ccd5"]]},{"id":"f077c5cb.764f28","type":"average","z":"e1506c1e.a4be5","name":"","topic":"","x":600,"y":500,"wires":[["389c7f06.36f94"]]},{"id":"6bd4c7cc.70aac8","type":"msg-router","z":"cba02be5.02efe8","routerType":"broadcast","topicDependent":false,"counterReset":false,"msgKeyField":"payload","undefinedHash":false,"outputsInfo":[{"active":true,"clone":false,"delay":"0","weight":"0"},{"active":true,"clone":false,"delay":"100","weight":"0"},{"active":true,"clone":false,"delay":"200","weight":"0"}],"name":"Router","delaying":"increment_active","msgControl":false,"outputs":3,"x":390,"y":140,"wires":[["1df5b30b.7c87cd"],["ce216f6e.41a2e"],["640abd70.580704"]]},{"id":"be8b72ff.8fe3b","type":"msg-router","z":"b7987fdf.32542","routerType":"broadcast","topicDependent":false,"counterReset":false,"msgKeyField":"payload","undefinedHash":false,"outputsInfo":[{"active":true,"clone":false,"delay":"0","weight":"0"},{"active":true,"clone":false,"delay":"0","weight":"0"}],"name":"","delaying":"unrelated","msgControl":false,"outputs":2,"x":900,"y":280,"wires":[["c0698bbd.b80db8"],["e2b8da45.2336c8"]]},{"id":"f08e415a.e09d","type":"msg-router","z":"235eedcf.c34822","routerType":"broadcast","topicDependent":false,"counterReset":false,"msgKeyField":"payload","undefinedHash":false,"outputsInfo":[{"active":true,"clone":false,"delay":"0","weight":"0"},{"active":true,"clone":false,"delay":"300","weight":"0"}],"name":"Router","delaying":"increment_active","msgControl":false,"outputs":2,"x":690,"y":260,"wires":[["f54910a8.7e83f"],["96ffd838.ac9e48"]]},{"id":"7e106b82.6f4164","type":"throttle","z":"cf48887c.47edf8","name":"","throttleType":"time","timeLimit":"30","timeLimitType":"seconds","countLimit":0,"blockSize":0,"locked":false,"x":710,"y":305,"wires":[["f1d55769.2b2928"]]},{"id":"295766c9.8c9efa","type":"throttle","z":"235eedcf.c34822","name":"Just 3 times","throttleType":"count","timeLimit":0,"timeLimitType":"seconds","countLimit":"3","blockSize":0,"locked":false,"x":510,"y":260,"wires":[["f08e415a.e09d"]]},{"id":"bd23fe9.a3e9b","type":"inject","z":"5e27b596.12bbbc","name":"on","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":80,"wires":[["7160b643.33a078"]]},{"id":"dbca136.d94a0f","type":"api-current-state","z":"5e27b596.12bbbc","name":"Office temp","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sensor.office_temperature","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":470,"y":1620,"wires":[["78f5c345.941acc"]]},{"id":"168d43e8.14a8ac","type":"inject","z":"5e27b596.12bbbc","name":"Once per minute","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":true,"onceDelay":0.1,"x":210,"y":1680,"wires":[["dbca136.d94a0f","d7f8f6c5.be8008","c9fe2eb7.948e6"]]},{"id":"d7f8f6c5.be8008","type":"api-current-state","z":"5e27b596.12bbbc","name":"Kitchen temp","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sensor.kitchen_temperature","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":470,"y":1680,"wires":[["78f5c345.941acc"]]},{"id":"c9fe2eb7.948e6","type":"api-current-state","z":"5e27b596.12bbbc","name":"Thermostat","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sensor.thermostat_temperature","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":470,"y":1740,"wires":[["78f5c345.941acc"]]},{"id":"78f5c345.941acc","type":"average","z":"5e27b596.12bbbc","name":"","topic":"","x":680,"y":1680,"wires":[["d2442e94.64ad6"]]},{"id":"d2442e94.64ad6","type":"debug","z":"5e27b596.12bbbc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":850,"y":1680,"wires":[]},{"id":"c20f5e29.66101","type":"api-call-service","z":"25056595.dda88a","name":"Door armed","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"input_text","service":"set_value","entityId":"input_text.911_door_armed","data":"{\"entity_id\":\"input_text.911_door_armed\", \"value\":\"armed\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":410,"y":1540,"wires":[["e250d9f4.218488"]]},{"id":"e731a8e8.d84788","type":"api-call-service","z":"25056595.dda88a","name":"Door disarmed","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"input_text","service":"set_value","entityId":"input_text.911_door_armed","data":"{\"entity_id\":\"input_text.911_door_armed\", \"value\":\"disarmed\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":420,"y":1600,"wires":[["e250d9f4.218488"]]},{"id":"ecb3bb93.2e0c28","type":"server-state-changed","z":"25056595.dda88a","name":"911 door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.disarm_911_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":80,"y":1560,"wires":[["d0f4ff33.b0a26"]]},{"id":"e250d9f4.218488","type":"debug","z":"25056595.dda88a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":670,"y":1560,"wires":[]},{"id":"d0f4ff33.b0a26","type":"switch","z":"25056595.dda88a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":1560,"wires":[["c20f5e29.66101"],["e731a8e8.d84788"]]},{"id":"ea29dfc4.c576b","type":"api-call-service","z":"25056595.dda88a","name":"Door armed","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"input_text","service":"set_value","entityId":"input_text.smart_door_armed","data":"{\"entity_id\":\"input_text.smart_door_armed\", \"value\":\"armed\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":410,"y":2040,"wires":[["5690c03.05a8f4"]]},{"id":"ba3a5cc6.b68a3","type":"api-call-service","z":"25056595.dda88a","name":"Door disarmed","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"input_text","service":"set_value","entityId":"input_text.smart_door_armed","data":"{\"entity_id\":\"input_text.smart_door_armed\", \"value\":\"disarmed\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":420,"y":2100,"wires":[["5690c03.05a8f4"]]},{"id":"be56dbdc.cc8b18","type":"server-state-changed","z":"25056595.dda88a","name":"Smart door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.disarm_smart_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":80,"y":2060,"wires":[["a4d60240.2e3af"]]},{"id":"5690c03.05a8f4","type":"debug","z":"25056595.dda88a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":670,"y":2060,"wires":[]},{"id":"a4d60240.2e3af","type":"switch","z":"25056595.dda88a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":2060,"wires":[["ea29dfc4.c576b"],["ba3a5cc6.b68a3"]]},{"id":"c61362e.0b3a9a","type":"server-state-changed","z":"f8a41b81.9486e8","name":"Office motion","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.office_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":210,"y":80,"wires":[["1c2432ec.672f5d"],[]]},{"id":"29be9178.ee722e","type":"server-state-changed","z":"f8a41b81.9486e8","name":"Doorbell motion","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.doorbell_camera_motion_detected","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":200,"y":140,"wires":[["1c2432ec.672f5d"],[]]},{"id":"aae03a72.2b4968","type":"server-state-changed","z":"f8a41b81.9486e8","name":"Garage motion","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.garage_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":200,"y":200,"wires":[["1c2432ec.672f5d"],[]]},{"id":"b5620d48.ba308","type":"server-state-changed","z":"f8a41b81.9486e8","name":"Kitchen motion","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.kitchen_cam_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":200,"y":260,"wires":[["1c2432ec.672f5d"],[]]},{"id":"d3fbd199.1fd6c","type":"server-state-changed","z":"f8a41b81.9486e8","name":"Living room motion","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.lr_alarm_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":190,"y":320,"wires":[["1c2432ec.672f5d"],[]]},{"id":"b914dfbf.614b4","type":"server-state-changed","z":"f8a41b81.9486e8","name":"Workbench motion","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.workbench_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":190,"y":380,"wires":[["1c2432ec.672f5d"],[]]},{"id":"e5e10610.70f278","type":"mqtt in","z":"eac2df63.5cf68","name":"TinyCar latitude","topic":"ovms/OVMS/JK4or2wo/metric/v/p/latitude","qos":"2","datatype":"auto","broker":"9afb58a1.205718","x":190,"y":820,"wires":[["87f476a7.87a2a8","9ea258af.c80d88"]]},{"id":"f21456aa.7bb118","type":"mqtt in","z":"eac2df63.5cf68","name":"TinyCar longitude","topic":"ovms/OVMS/JK4or2wo/metric/v/p/longitude","qos":"2","datatype":"utf8","broker":"9afb58a1.205718","x":180,"y":920,"wires":[["12806cfc.dd3213","3a391166.b3b9fe"]]},{"id":"12806cfc.dd3213","type":"debug","z":"eac2df63.5cf68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":390,"y":960,"wires":[]},{"id":"87f476a7.87a2a8","type":"debug","z":"eac2df63.5cf68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":390,"y":860,"wires":[]},{"id":"9638c7b8.332a48","type":"debug","z":"eac2df63.5cf68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":950,"y":900,"wires":[]},{"id":"3a170b87.f8ea04","type":"join","z":"eac2df63.5cf68","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":",","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":690,"y":860,"wires":[["9638c7b8.332a48","7344e864.538e98"]]},{"id":"9ea258af.c80d88","type":"function","z":"eac2df63.5cf68","name":"","func":"msg.parts = 1;\n//msg.payload = \"latitude: \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":820,"wires":[["3a170b87.f8ea04"]]},{"id":"3a391166.b3b9fe","type":"function","z":"eac2df63.5cf68","name":"","func":"msg.parts = 2;\nmsg.complete = 1;\n//msg.payload = \"latitude: \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":920,"wires":[["3a170b87.f8ea04"]]},{"id":"7344e864.538e98","type":"mqtt out","z":"eac2df63.5cf68","name":"location/tinycar","topic":"location/tinycar","qos":"","retain":"","broker":"9afb58a1.205718","x":960,"y":840,"wires":[]},{"id":"8b5a5229.83125","type":"inject","z":"eac2df63.5cf68","name":"JSON String","topic":"","payload":"{\"a\":1}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":1140,"wires":[["bcbfcad7.2f9548"]]},{"id":"bcbfcad7.2f9548","type":"json","z":"eac2df63.5cf68","name":"","property":"payload","action":"","pretty":false,"x":410,"y":1140,"wires":[["27c66e21.201392"]]},{"id":"27c66e21.201392","type":"debug","z":"eac2df63.5cf68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":1140,"wires":[]},{"id":"6b10b3e1.67a48c","type":"inject","z":"eac2df63.5cf68","name":"Object","topic":"","payload":"{\"a\":1}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":1180,"wires":[["5f453627.c855e8"]]},{"id":"5f453627.c855e8","type":"json","z":"eac2df63.5cf68","name":"","property":"payload","action":"","pretty":false,"x":410,"y":1180,"wires":[["6c9a50b2.33044"]]},{"id":"6c9a50b2.33044","type":"debug","z":"eac2df63.5cf68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":1180,"wires":[]},{"id":"53a8c05c.29b81","type":"change","z":"eac2df63.5cf68","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":1020,"wires":[[]]},{"id":"7c6c5a0d.3cd254","type":"template","z":"eac2df63.5cf68","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"longitude\": {{payload}} ","output":"str","x":580,"y":980,"wires":[[]]},{"id":"263d883d.7f7f28","type":"debug","z":"eac2df63.5cf68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":1280,"wires":[]},{"id":"c3f81fba.c1edb","type":"api-current-state","z":"eac2df63.5cf68","name":"","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.freezer_temperature","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":400,"y":1280,"wires":[["2650350c.4b3d5a"]]},{"id":"836cf216.d4a0e","type":"inject","z":"eac2df63.5cf68","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":1280,"wires":[["c3f81fba.c1edb"]]},{"id":"2650350c.4b3d5a","type":"function","z":"eac2df63.5cf68","name":"","func":"msg.payload = \"Freezer temperature: \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":1280,"wires":[["263d883d.7f7f28"]]},{"id":"b14960c4.bee1f","type":"mqtt in","z":"eac2df63.5cf68","name":"TinyCar Parktime","topic":"ovms/OVMS/JK4or2wo/metric/v/d/cp","qos":"2","datatype":"utf8","broker":"9afb58a1.205718","x":180,"y":1040,"wires":[["72de2385.e8ce6c"]]},{"id":"72de2385.e8ce6c","type":"function","z":"eac2df63.5cf68","name":"","func":"msg.payload = \"Chargeport: \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1080,"wires":[["27c66e21.201392"]]},{"id":"79cdf139.5f7f1","type":"template","z":"eac2df63.5cf68","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"latitude\": {{payload}} ","output":"str","x":520,"y":740,"wires":[[]]},{"id":"91ffe84e.a15668","type":"trigger","z":"5e27b596.12bbbc","op1":"on_override 03:00","op2":"0","op1type":"str","op2type":"str","duration":"250","extend":false,"units":"ms","reset":"","bytopic":"all","name":"on_override 03:00","x":270,"y":200,"wires":[["7160b643.33a078"]]},{"id":"23391c94.ce5dd4","type":"inject","z":"eac2df63.5cf68","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":880,"wires":[["9ea258af.c80d88","3a391166.b3b9fe"]]},{"id":"86f61915.e72828","type":"api-call-service","z":"84e379b8.2c3a08","name":"Show front door","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"browser_mod","service":"navigate","entityId":"media_player.fully","data":"{\"navigation_path\":\"/lovelace/1\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":500,"y":100,"wires":[[]]},{"id":"e180ecc9.7c6c2","type":"inject","z":"84e379b8.2c3a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":100,"wires":[["86f61915.e72828"]]},{"id":"655ab1ba.e93b1","type":"comment","z":"84e379b8.2c3a08","name":"This puts the front door live view on the samsung tablet","info":"","x":440,"y":40,"wires":[]},{"id":"dde0a16f.7ccef","type":"api-call-service","z":"84e379b8.2c3a08","name":"Pop up","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"browser_mod","service":"popup","entityId":"media_player.fully","data":"{\"card_type\":\"entities\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":520,"y":280,"wires":[[]]},{"id":"1536ed2b.0a3be3","type":"inject","z":"84e379b8.2c3a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":280,"wires":[["dde0a16f.7ccef"]]},{"id":"3ff751ef.02fc2e","type":"comment","z":"84e379b8.2c3a08","name":"This pops up a card on the samsung tablet","info":"","x":400,"y":220,"wires":[]},{"id":"a618a1d0.02f8b","type":"api-call-service","z":"84e379b8.2c3a08","name":"Play media","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.fully","data":"{\"media_content_id\":\"k. e. x. p.\",\"media_content_type\":\"TUNEIN\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":480,"wires":[[]]},{"id":"b1237ceb.ceb86","type":"inject","z":"84e379b8.2c3a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":480,"wires":[["a618a1d0.02f8b"]]},{"id":"75d663c3.3c166c","type":"api-call-service","z":"84e379b8.2c3a08","name":"Turn screen off","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"browser_mod","service":"blackout","entityId":"media_player.fully","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":400,"wires":[[]]},{"id":"afae1aa5.4add78","type":"inject","z":"84e379b8.2c3a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":280,"y":400,"wires":[["75d663c3.3c166c"]]},{"id":"da43a31d.34c7","type":"server-events","z":"eac2df63.5cf68","name":"On HA start","server":"29d635fb.a91c9a","event_type":"homeassistant_start","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":110,"y":180,"wires":[[]]},{"id":"352ba09b.b1994","type":"server-state-changed","z":"8b414f68.37d25","name":"Entering office","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.oneplus_5_room_presence","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"office","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":150,"y":1120,"wires":[["c9e5d565.885c38"],[]]},{"id":"62589498.92b6dc","type":"debug","z":"8b414f68.37d25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":950,"y":1160,"wires":[]},{"id":"53d658ae.8c8648","type":"function","z":"8b414f68.37d25","name":"home or not","func":"var message=msg.payload;\nvar newmsg={payload: \"Jake is in thee\" + message};\nreturn newmsg;","outputs":1,"noerr":0,"x":690,"y":1140,"wires":[["62589498.92b6dc","edb53bac.1ae9d8","3a28d9dc.f9c396"]]},{"id":"bd4f5d88.7e6f8","type":"server-state-changed","z":"8b414f68.37d25","name":"Entering office","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.oneplus_5_room_presence","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"garage","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":150,"y":1180,"wires":[["c9e5d565.885c38"],[]]},{"id":"c9e5d565.885c38","type":"throttle","z":"8b414f68.37d25","name":"","throttleType":"count","timeLimit":0,"timeLimitType":"seconds","countLimit":"3","blockSize":0,"locked":false,"x":440,"y":1140,"wires":[["53d658ae.8c8648"]]},{"id":"fdc76e40.948ca","type":"switch","z":"be3e73a2.2f6e6","name":"switch","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":230,"y":280,"wires":[["9e041c48.d169b"],["6f145290.7a06ec"]]},{"id":"d527a52d.e80a68","type":"server-state-changed","z":"be3e73a2.2f6e6","name":"Washer status","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.washer_w_lav","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":90,"y":280,"wires":[["fdc76e40.948ca"]]},{"id":"6f145290.7a06ec","type":"change","z":"be3e73a2.2f6e6","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":300,"wires":[["a5f5d4aa.25cfa8"]]},{"id":"9e041c48.d169b","type":"function","z":"be3e73a2.2f6e6","name":"Was just false?","func":"if(msg.data !== null && msg.data.old_state !== null) {\n    if(msg.data.old_state.state === \"False\") {\n        return msg\n    }\n}\nreturn null;","outputs":1,"noerr":0,"x":370,"y":240,"wires":[["a5f5d4aa.25cfa8"]]},{"id":"a5f5d4aa.25cfa8","type":"delay","z":"be3e73a2.2f6e6","name":"Wait 2 mins","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":550,"y":260,"wires":[["fbe23780.2be328"]]},{"id":"fbe23780.2be328","type":"api-current-state","z":"be3e73a2.2f6e6","name":"Not guest mode?","server":"29d635fb.a91c9a","version":"1","outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.guest_mode","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":730,"y":260,"wires":[[],["8edd0da2.06a66"]]},{"id":"8edd0da2.06a66","type":"api-call-service","z":"be3e73a2.2f6e6","name":"Sonos: \"The washing machine is finished\"","server":"29d635fb.a91c9a","version":"1","debugenabled":false,"service_domain":"script","service":"sonos_say","entityId":"","data":"{\"delay\": \"00:00:05\", \"message\" : \"The washing machine is finished\", \"volume\": 0.3, \"sonos_entity\" : \"media_player.kitchen\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1020,"y":260,"wires":[[]]},{"id":"7f043f48.655b8","type":"trigger-state","z":"838b375b.a3fcd8","name":"Washer finishes","server":"29d635fb.a91c9a","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"sensor.washer_power","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"q90kc9155s","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"<=","comparatorValueDatatype":"num","comparatorValue":"10"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":180,"y":320,"wires":[["4cf37291.a4131c"],["28afead9.4acb16"]]},{"id":"4cf37291.a4131c","type":"debug","z":"838b375b.a3fcd8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":400,"y":300,"wires":[]},{"id":"28afead9.4acb16","type":"debug","z":"838b375b.a3fcd8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":400,"y":360,"wires":[]},{"id":"778f2c7.41385d4","type":"inject","z":"838b375b.a3fcd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":260,"wires":[["7f043f48.655b8"]]},{"id":"dd02b426.36b258","type":"change","z":"838b375b.a3fcd8","name":"Make speech","rules":[{"t":"set","p":"payload","pt":"msg","to":"Laundry indicator reset","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690.9964098930359,"y":839.656252861023,"wires":[["82eac3dd.772b9"]]},{"id":"22a4745b.fee9ac","type":"server-state-changed","z":"838b375b.a3fcd8","name":"Dryer text","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_text.dryer_running","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":70,"y":420,"wires":[[]]},{"id":"daf72ed8.125f7","type":"api-call-service","z":"ecafd5c5.2d8028","name":"Office Alexa","server":"29d635fb.a91c9a","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"test\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.office\",\"serialNumber\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":530,"y":80,"wires":[[]]},{"id":"fc4705ee.d6cfd8","type":"api-call-service","z":"ed60b07d.9ec52","name":"Garage Alexa","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"test\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.garage\",\"serialNumber\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":540,"y":80,"wires":[[]]},{"id":"82a5ef48.a9083","type":"api-call-service","z":"2ab0d9fb.322536","name":"Kitchen Alexa","server":"29d635fb.a91c9a","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"test\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.kitchen\",\"serialNumber\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":540,"y":80,"wires":[[]]},{"id":"55ecc072.66b11","type":"subflow:ecafd5c5.2d8028","z":"5e27b596.12bbbc","name":"","x":930,"y":380,"wires":[]},{"id":"bc6a6bfd.bfa678","type":"subflow:cc5ab19e.7bb6f","z":"eac2df63.5cf68","name":"","x":1220,"y":640,"wires":[]},{"id":"f281f11f.ad7c5","type":"subflow:cba02be5.02efe8","z":"eff727ba.42a3a8","x":920,"y":460,"wires":[]},{"id":"efbb3641.9b1de8","type":"subflow:cba02be5.02efe8","z":"25056595.dda88a","name":"","x":870,"y":120,"wires":[]},{"id":"82ea8589.0608b8","type":"subflow:cba02be5.02efe8","z":"25056595.dda88a","name":"","x":1010,"y":680,"wires":[]},{"id":"97b66533.4724b8","type":"subflow:cc5ab19e.7bb6f","z":"25056595.dda88a","name":"","x":1000,"y":320,"wires":[]},{"id":"66332825.3970e8","type":"subflow:ecafd5c5.2d8028","z":"e9c46f27.b8a08","name":"","x":930,"y":280,"wires":[]},{"id":"f0b607de.af2598","type":"inject","z":"215b943e.474c3c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":220,"wires":[["4c774fc5.4f94"]]},{"id":"4e463cd4.8a1b84","type":"subflow:cba02be5.02efe8","z":"838b375b.a3fcd8","name":"","x":1210,"y":100,"wires":[]},{"id":"7d37a7ec.a54b98","type":"subflow:cba02be5.02efe8","z":"838b375b.a3fcd8","name":"","x":1090,"y":540,"wires":[]},{"id":"82eac3dd.772b9","type":"subflow:cba02be5.02efe8","z":"838b375b.a3fcd8","name":"","x":850,"y":840,"wires":[]},{"id":"edb53bac.1ae9d8","type":"subflow:ecafd5c5.2d8028","z":"8b414f68.37d25","name":"","x":990,"y":1120,"wires":[]},{"id":"c5ea0c48.80504","type":"subflow:ecafd5c5.2d8028","z":"8b414f68.37d25","name":"","x":990,"y":1480,"wires":[]},{"id":"3a28d9dc.f9c396","type":"subflow:cc5ab19e.7bb6f","z":"8b414f68.37d25","name":"","x":1040,"y":1000,"wires":[]},{"id":"8c9af54f.4646a8","type":"subflow:cba02be5.02efe8","z":"2b590643.985dca","name":"","x":970,"y":260,"wires":[]},{"id":"e8bc6436.3abdd8","type":"subflow:cba02be5.02efe8","z":"2b590643.985dca","name":"","x":970,"y":760,"wires":[]},{"id":"5a63b161.de5a5","type":"subflow:cba02be5.02efe8","z":"2b590643.985dca","name":"","x":970,"y":1280,"wires":[]},{"id":"f54910a8.7e83f","type":"subflow:cba02be5.02efe8","z":"235eedcf.c34822","name":"","x":850,"y":240,"wires":[]},{"id":"96ffd838.ac9e48","type":"subflow:cc5ab19e.7bb6f","z":"235eedcf.c34822","name":"","x":860,"y":280,"wires":[]},{"id":"ae7a357.6f8abc8","type":"debug","z":"8b414f68.37d25","name":"Home","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":630,"y":800,"wires":[]},{"id":"fc64c378.67e88","type":"inject","z":"8b414f68.37d25","name":"","topic":"","payload":"A thing","payloadType":"str","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":440,"wires":[[]]},{"id":"f692088e.3a1278","type":"inject","z":"8b414f68.37d25","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":140,"wires":[["46cc1762.906268","ca8bce70.74153"]]},{"id":"8068cfc0.fa253","type":"debug","z":"8b414f68.37d25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":910,"y":80,"wires":[]},{"id":"46cc3461.26c4ac","type":"debug","z":"8b414f68.37d25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":910,"y":140,"wires":[]},{"id":"46cc1762.906268","type":"api-current-state","z":"8b414f68.37d25","name":"Jacob Home","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"home","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.jake_person","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":550,"y":140,"wires":[["8068cfc0.fa253"],["46cc3461.26c4ac"]],"outputLabels":["Is Home","Is Not Home"]},{"id":"9db5e129.7ffdd","type":"server-state-changed","z":"8b414f68.37d25","name":"Jake","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.jake_person","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":260,"wires":[["1ba1740b.577e1c"]]},{"id":"ca8bce70.74153","type":"ha-wait-until","z":"8b414f68.37d25","name":"Is Jake home","server":"29d635fb.a91c9a","outputs":2,"entityId":"person.jake_person","entityIdFilterType":"exact","property":"state","comparator":"is","value":"home","valueType":"str","timeout":"3","timeoutType":"num","timeoutUnits":"seconds","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":550,"y":240,"wires":[["d7610276.f6c2a"],["3b46124e.1e5afe"]]},{"id":"d7610276.f6c2a","type":"debug","z":"8b414f68.37d25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":910,"y":240,"wires":[]},{"id":"3b46124e.1e5afe","type":"debug","z":"8b414f68.37d25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":910,"y":300,"wires":[]},{"id":"eedbac4e.733fe","type":"subflow:a2de79f8.d4c028","z":"215b943e.474c3c","x":1060,"y":80,"wires":[]},{"id":"1ba1740b.577e1c","type":"state-machine","z":"8b414f68.37d25","name":"Where's Jake","triggerProperty":"topic","triggerPropertyType":"msg","stateProperty":"topic","statePropertyType":"msg","outputStateChangeOnly":true,"throwException":false,"states":["Home","Not Home"],"transitions":[{"name":"home","from":"Not Home","to":"Home"},{"name":"not_home","from":"Home","to":"Not Home"}],"x":500,"y":460,"wires":[["f5dee146.85a11","dc5bbdb5.4c559"]]},{"id":"f5dee146.85a11","type":"debug","z":"8b414f68.37d25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":810,"y":440,"wires":[]},{"id":"dc5bbdb5.4c559","type":"debug","z":"8b414f68.37d25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":810,"y":500,"wires":[]},{"id":"c5aa8a7a.86e568","type":"inject","z":"838b375b.a3fcd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320,"y":420,"wires":[["25ede00d.06f26"]]},{"id":"d789f01c.07e0c","type":"api-call-service","z":"f8a41b81.9486e8","name":"Last_motion","server":"29d635fb.a91c9a","version":1,"debugenabled":true,"service_domain":"var","service":"set","entityId":"var.last_motion","data":"{\"entity_id\": \"var.last_motion\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":610,"y":240,"wires":[[]]},{"id":"1c2432ec.672f5d","type":"template","z":"f8a41b81.9486e8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{data.new_state.attributes.friendly_name}}","output":"str","x":460,"y":240,"wires":[["d789f01c.07e0c"]]},{"id":"69c04624.6e5608","type":"server-state-changed","z":"a7b0f219.2da23","name":"911","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.garage_opened_911","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":80,"wires":[["b557a3e4.273fd"]]},{"id":"e5a4f30d.faa47","type":"server-state-changed","z":"a7b0f219.2da23","name":"Smart","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.garage_opened_smart","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":140,"wires":[["b557a3e4.273fd"]]},{"id":"788c304.de25fd","type":"api-call-service","z":"a7b0f219.2da23","name":"Last_vehicle","server":"29d635fb.a91c9a","version":1,"debugenabled":true,"service_domain":"var","service":"set","entityId":"var.last_vehicle","data":"{\"entity_id\": \"var.last_vehicle\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":750,"y":120,"wires":[[]]},{"id":"b557a3e4.273fd","type":"template","z":"a7b0f219.2da23","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{data.new_state.attributes.friendly_name}}","output":"str","x":400,"y":120,"wires":[["e741d05a.e3ead"]]},{"id":"c60ef154.2d8b4","type":"api-current-state","z":"bdd4ada0.860a7","name":"Shop door state","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"cover.shop_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":200,"y":80,"wires":[["5c168e1c.93188"]]},{"id":"97efc010.6d9ea","type":"api-current-state","z":"8092f866.de7468","name":"Truck door state","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"cover.truck_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":200,"y":80,"wires":[["8bba1280.fab8b"]]},{"id":"5c168e1c.93188","type":"switch","z":"bdd4ada0.860a7","name":"Is it closed","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"closed","vt":"str"},{"t":"eq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":80,"wires":[[],["98c84c21.d3bbf","49604a08.3f9b44"]]},{"id":"8bba1280.fab8b","type":"switch","z":"8092f866.de7468","name":"Is it closed","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"closed","vt":"str"},{"t":"eq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":80,"wires":[[],["fade02e1.1d6ed"]]},{"id":"c11e002d.a4d08","type":"api-call-service","z":"8092f866.de7468","name":"Close Truck Door","server":"29d635fb.a91c9a","version":1,"service_domain":"cover","service":"close_cover","entityId":"cover.truck_door","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":590,"y":160,"wires":[[]]},{"id":"49604a08.3f9b44","type":"api-call-service","z":"bdd4ada0.860a7","name":"Close shop door","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"cover","service":"close_cover","entityId":"cover.shop_door","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":600,"y":80,"wires":[[]]},{"id":"98c84c21.d3bbf","type":"change","z":"bdd4ada0.860a7","name":"\"Closing shop door\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Closing Shop Door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":140,"wires":[[]]},{"id":"129a2d87.51ec72","type":"change","z":"8092f866.de7468","name":"\"Closing truck door\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Closing truck door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":100,"wires":[[]]},{"id":"fade02e1.1d6ed","type":"delay","z":"8092f866.de7468","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":100,"wires":[["129a2d87.51ec72","c11e002d.a4d08"]]},{"id":"9be8e0e7.bd8e5","type":"trigger-state","z":"25056595.dda88a","name":"Close both doors","server":"29d635fb.a91c9a","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_boolean.close_doors","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":270,"y":120,"wires":[["fe2286b7.0e34c8","f2d2d6aa.f5afe8"],[]]},{"id":"e21965bd.5094f8","type":"msg-router","z":"25056595.dda88a","routerType":"broadcast","topicDependent":false,"counterReset":false,"msgKeyField":"payload","undefinedHash":false,"outputsInfo":[{"active":true,"clone":false,"delay":"0","weight":"0"},{"active":true,"clone":false,"delay":"300","weight":"0"}],"name":"Router","delaying":"increment_active","msgControl":false,"outputs":2,"x":690,"y":120,"wires":[["efbb3641.9b1de8"],[]]},{"id":"fe2286b7.0e34c8","type":"subflow:bdd4ada0.860a7","z":"25056595.dda88a","x":500,"y":80,"wires":[["e21965bd.5094f8"]]},{"id":"f2d2d6aa.f5afe8","type":"subflow:8092f866.de7468","z":"25056595.dda88a","x":510,"y":160,"wires":[["e21965bd.5094f8"]]},{"id":"bc7ac8c6.417478","type":"subflow:bdd4ada0.860a7","z":"25056595.dda88a","name":"","x":1140,"y":1520,"wires":[[]]},{"id":"fcbbab75.9b0668","type":"subflow:8092f866.de7468","z":"25056595.dda88a","name":"","x":1150,"y":1920,"wires":[[]]},{"id":"f6c7dedc.4a321","type":"server-state-changed","z":"fe2f3ca8.f94af","name":"12 Back Door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.back_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":200,"wires":[[]]},{"id":"d981d8be.083038","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"15 Bathroom Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bathroom_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":140,"wires":[[]]},{"id":"643e4171.62a4a","type":"server-state-changed","z":"fe2f3ca8.f94af","name":"10 Front Door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.front_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":80,"wires":[[]]},{"id":"6981e5a9.12c35c","type":"server-state-changed","z":"fe2f3ca8.f94af","name":"30 Garage Fire Door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.garage_fire_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":210,"y":260,"wires":[[]]},{"id":"10b7ca3b.001876","type":"server-state-changed","z":"8ff98bb0.b2c218","name":"34 Garage Motion","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.garage_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":80,"wires":[[]]},{"id":"b779639c.e767c","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"25 Guest NW Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.gbr_nw_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":740,"wires":[[]]},{"id":"76dcd5a2.ad82bc","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"23 Guest South Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.gbr_south_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":210,"y":620,"wires":[[]]},{"id":"70452f64.51adf","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"24 Guest SW Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.gbr_sw_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":680,"wires":[[]]},{"id":"37332e64.1e7cb2","type":"server-state-changed","z":"7381bffb.6559f","name":"28 Keyfob Away","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.keyfob_away","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":200,"wires":[[]]},{"id":"3634489.27692b8","type":"server-state-changed","z":"7381bffb.6559f","name":"27 Keyfob Disarm","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.keyfob_disarm","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":210,"y":140,"wires":[[]]},{"id":"88f81979.c7db58","type":"server-state-changed","z":"7381bffb.6559f","name":"26 Keyfob Panic","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.keyfob_panic","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":80,"wires":[[]]},{"id":"83ed308.43575d","type":"server-state-changed","z":"7381bffb.6559f","name":"29 Keyfob Stay","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.keyfob_stay","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":260,"wires":[[]]},{"id":"4837509.877aab","type":"server-state-changed","z":"fe2f3ca8.f94af","name":"11 Kitchen Door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.kitchen_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":140,"wires":[[]]},{"id":"75122ef3.ea0b1","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"14 Kitchen Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.kitchen_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":80,"wires":[[]]},{"id":"17d15ccd.68ae63","type":"server-state-changed","z":"fe2f3ca8.f94af","name":"38 Laundry Room Door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.laundry_room_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":220,"y":320,"wires":[[]]},{"id":"d27a0f61.a01e6","type":"server-state-changed","z":"8ff98bb0.b2c218","name":"13 Living Room Motion","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.lr_alarm_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":140,"wires":[[]]},{"id":"fd8af785.0b4518","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"21 Living Room SE Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.lr_se_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":220,"y":500,"wires":[[]]},{"id":"3d78ec8c.982984","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"17 Bedroom E Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.mbr_e_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":260,"wires":[[]]},{"id":"3b9dc1f7.a3d74e","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"16 Bedroom N Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.mbr_n_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":200,"wires":[[]]},{"id":"ee033dd1.de246","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"18 Office E Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.office_e_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":320,"wires":[[]]},{"id":"b51b2cc1.5658f","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"19 Office SE Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.office_se_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":380,"wires":[[]]},{"id":"1d0ddc8d.0eb293","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"20 Office SW Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.office_sw_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":440,"wires":[[]]},{"id":"71c355b4.3a208c","type":"server-state-changed","z":"7381bffb.6559f","name":"39 East Gate","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.east_gate","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":320,"wires":[[]]},{"id":"e7de1516.397688","type":"server-state-changed","z":"7381bffb.6559f","name":"40 West Gate","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.west_gate","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":380,"wires":[[]]},{"id":"b2151e92.e937c","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"22 Living Room SW Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.lr_sw_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":220,"y":560,"wires":[[]]},{"id":"12dd0944.1f0917","type":"server-state-changed","z":"fe2f3ca8.f94af","name":"42 Kitchen Laundry Door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.kitchen_laundry_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":230,"y":380,"wires":[[]]},{"id":"138de9f2.c9ae56","type":"server-state-changed","z":"fe2f3ca8.f94af","name":"35 Shop Garage Door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.shop_door_sensor","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":220,"y":440,"wires":[[]]},{"id":"79085489.e2eb8c","type":"server-state-changed","z":"fe2f3ca8.f94af","name":"36 Truck Garage Door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.garage_truck_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":220,"y":500,"wires":[[]]},{"id":"58e7ac65.6b60d4","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"31 Garage N Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.north_garage_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":800,"wires":[[]]},{"id":"b2548327.c481d","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"32 Garage AC Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.garage_ac_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":860,"wires":[[]]},{"id":"a725c89b.85ff88","type":"server-state-changed","z":"90f9a58f.0b08e8","name":"33 Garage E Window","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.east_garage_window","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":920,"wires":[[]]},{"id":"6f59caf4.e1bde4","type":"server-state-changed","z":"fe2f3ca8.f94af","name":"37 Garage Shed Door","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.garage_shed_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":220,"y":560,"wires":[[]]},{"id":"ab3b14c6.e3a9f8","type":"server-state-changed","z":"7381bffb.6559f","name":"41 Mail Box","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.mailbox","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":440,"wires":[[]]},{"id":"25a3ade3.1ff2d2","type":"subflow:90f9a58f.0b08e8","z":"b47b41ce.34bdf","x":220,"y":140,"wires":[["d4e416e2.54c888"]]},{"id":"cba45028.c6dec","type":"subflow:fe2f3ca8.f94af","z":"b47b41ce.34bdf","x":210,"y":80,"wires":[["d4e416e2.54c888"]]},{"id":"2208509f.08ad1","type":"subflow:8ff98bb0.b2c218","z":"b47b41ce.34bdf","x":210,"y":200,"wires":[["d4e416e2.54c888"]]},{"id":"b290a428.34efe8","type":"subflow:7381bffb.6559f","z":"b47b41ce.34bdf","x":200,"y":260,"wires":[["d4e416e2.54c888"]]},{"id":"e716a167.b5ae7","type":"api-call-service","z":"b47b41ce.34bdf","name":"Var Last Alarm","server":"29d635fb.a91c9a","version":1,"debugenabled":true,"service_domain":"var","service":"set","entityId":"var.last_alarm","data":"{\"entity_id\": \"var.last_alarm\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":640,"y":160,"wires":[[]]},{"id":"d4e416e2.54c888","type":"template","z":"b47b41ce.34bdf","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{data.new_state.attributes.friendly_name}}","output":"str","x":480,"y":160,"wires":[["e716a167.b5ae7"]]},{"id":"5f69e2f3.cf55cc","type":"inject","z":"5e27b596.12bbbc","name":"Turn off at 3 PM","topic":"","payload":"OFF","payloadType":"str","repeat":"","crontab":"00 15 * * *","once":false,"onceDelay":0.1,"x":250,"y":540,"wires":[["978b9925.5d3c58"]]},{"id":"978b9925.5d3c58","type":"api-call-service","z":"5e27b596.12bbbc","name":"Turn off coffee pot","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.shelly_shsw_1_5bab14","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":510,"y":540,"wires":[["1f718392.7f3f1c"]]},{"id":"ec7b3049.45e46","type":"comment","z":"5e27b596.12bbbc","name":"TURN OFF COFFEE EVERY DAY AT 3 PM","info":"","x":580,"y":480,"wires":[]},{"id":"860344da.7b5e28","type":"comment","z":"5469bf4.95d0d4","name":"TRIGGER ALARM CLOCK","info":"","x":150,"y":80,"wires":[]},{"id":"e6c88b9b.70f618","type":"join","z":"5469bf4.95d0d4","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":650,"y":140,"wires":[["38c06c7.8c67a94"]]},{"id":"38c06c7.8c67a94","type":"function","z":"5469bf4.95d0d4","name":"Compare Times","func":"newmsg = {};\nif (msg.payload[0] == msg.payload[1]) {\n    newmsg.payload = \"True\";\n} else {\n    newmsg.payload = \"False\";\n}\n\nreturn newmsg;","outputs":1,"noerr":0,"x":660,"y":200,"wires":[["dba9667d.ff8998"]]},{"id":"dba9667d.ff8998","type":"switch","z":"5469bf4.95d0d4","name":"Is it Time?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":260,"wires":[["525553d6.b9e03c"]]},{"id":"3bfba7c8.815b08","type":"api-current-state","z":"5469bf4.95d0d4","name":"Is Jake home?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"away","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.jake_person","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":140,"y":180,"wires":[[],["87cc10cf.b5769","7c4aad81.7e3eb4"]],"outputLabels":["Not Home","Home"]},{"id":"87cc10cf.b5769","type":"api-current-state","z":"5469bf4.95d0d4","name":"Get Alarm Time","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_datetime.next_alarm","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":400,"y":260,"wires":[["55e5c18a.ddfb"]]},{"id":"7c4aad81.7e3eb4","type":"moment","z":"5469bf4.95d0d4","name":"Current Time","topic":"","input":"payload","inputType":"msg","inTz":"America/New_York","adjAmount":"0","adjType":"minutes","adjDir":"subtract","format":"H:mm","locale":"C","output":"payload","outputType":"msg","outTz":"America/New_York","x":410,"y":140,"wires":[["e6c88b9b.70f618"]]},{"id":"ecb6d42e.737298","type":"inject","z":"5469bf4.95d0d4","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":120,"wires":[["3bfba7c8.815b08"]]},{"id":"55e5c18a.ddfb","type":"moment","z":"5469bf4.95d0d4","name":"Alarm - 25min","topic":"","input":"payload","inputType":"msg","inTz":"America/New_York","adjAmount":"25","adjType":"minutes","adjDir":"subtract","format":"H:mm","locale":"C","output":"payload","outputType":"msg","outTz":"America/New_York","x":400,"y":200,"wires":[["e6c88b9b.70f618"]]},{"id":"525553d6.b9e03c","type":"api-call-service","z":"5469bf4.95d0d4","name":"House State - Waking Up","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"var","service":"set","entityId":"var.house_state","data":"{\"entity_id\":\"var.house_state\",\"value\":\"Waking Up\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":870,"y":260,"wires":[[]]},{"id":"b967757d.f66258","type":"comment","z":"5469bf4.95d0d4","name":"START ALARM CLOCK SEQUENCE","info":"","x":190,"y":360,"wires":[]},{"id":"b91344a4.891c28","type":"comment","z":"5469bf4.95d0d4","name":"Make Coffee at T -25 minutes","info":"","x":620,"y":380,"wires":[]},{"id":"b03cd960.e19478","type":"switch","z":"5469bf4.95d0d4","name":"Is it Time?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":390,"y":420,"wires":[["d57c345a.9aead8"]]},{"id":"4878a283.65ff4c","type":"server-state-changed","z":"5469bf4.95d0d4","name":"Wake Up House","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"var.house_state","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"Waking Up","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":120,"y":420,"wires":[["b03cd960.e19478"],[]]},{"id":"d57c345a.9aead8","type":"api-call-service","z":"5469bf4.95d0d4","name":"Make Coffee","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.shelly_shsw_1_5bab14","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":630,"y":420,"wires":[["789213c.d1d99ec"]]},{"id":"28060d6a.dda3f2","type":"mqtt out","z":"5469bf4.95d0d4","name":"Coffepot status","topic":"CoffeePot/status","qos":"","retain":"","broker":"9afb58a1.205718","x":1160,"y":420,"wires":[]},{"id":"445d0173.0a30e","type":"comment","z":"5469bf4.95d0d4","name":"*********************************   At alarm time +10   *********************************","info":"","x":570,"y":960,"wires":[]},{"id":"94900cb.1b2ccf","type":"comment","z":"5469bf4.95d0d4","name":"*********************************   At alarm time from phone   *********************************","info":"","x":570,"y":640,"wires":[]},{"id":"d139f738.8a6618","type":"join","z":"5469bf4.95d0d4","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":610,"y":700,"wires":[["e80b3061.0f4c"]]},{"id":"e80b3061.0f4c","type":"function","z":"5469bf4.95d0d4","name":"Compare Times","func":"newmsg = {};\nif (msg.payload[0] == msg.payload[1]) {\n    newmsg.payload = \"True\";\n} else {\n    newmsg.payload = \"False\";\n}\n\nreturn newmsg;","outputs":1,"noerr":0,"x":660,"y":760,"wires":[["fff71886.e28088"]]},{"id":"71d97892.656d58","type":"api-current-state","z":"5469bf4.95d0d4","name":"Alarm Clock ON?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_option_alarmclock","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":150,"y":760,"wires":[[],["e22322f8.002ac","d70d1a8a.170538"]]},{"id":"e22322f8.002ac","type":"api-current-state","z":"5469bf4.95d0d4","name":"Get Alarm Time","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_datetime.next_alarm","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":400,"y":820,"wires":[["5a67f413.c1545c"]]},{"id":"d70d1a8a.170538","type":"moment","z":"5469bf4.95d0d4","name":"Current Time","topic":"","input":"payload","inputType":"msg","inTz":"America/New_York","adjAmount":"0","adjType":"minutes","adjDir":"subtract","format":"H:mm","locale":"C","output":"payload","outputType":"msg","outTz":"America/New_York","x":390,"y":700,"wires":[["d139f738.8a6618"]]},{"id":"84e71964.0d9058","type":"inject","z":"5469bf4.95d0d4","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":700,"wires":[["71d97892.656d58"]]},{"id":"5a67f413.c1545c","type":"moment","z":"5469bf4.95d0d4","name":"At alarm time","topic":"","input":"payload","inputType":"msg","inTz":"America/New_York","adjAmount":"0","adjType":"minutes","adjDir":"subtract","format":"H:mm","locale":"C","output":"payload","outputType":"msg","outTz":"America/New_York","x":390,"y":760,"wires":[["d139f738.8a6618"]]},{"id":"8fbe90a2.ec667","type":"api-call-service","z":"5469bf4.95d0d4","name":"Play KEXP","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.office","data":"{\"media_content_id\":\"k. e. x. p.\",\"media_content_type\":\"TUNEIN\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1090,"y":640,"wires":[[]]},{"id":"75aa0f41.70586","type":"api-call-service","z":"5469bf4.95d0d4","name":"Turn on office light","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.office_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1110,"y":700,"wires":[[]]},{"id":"19838dc8.155ad2","type":"mqtt out","z":"5469bf4.95d0d4","name":"","topic":"status/OfficeFan","qos":"","retain":"","broker":"9afb58a1.205718","x":1300,"y":820,"wires":[]},{"id":"528fce7d.fa66","type":"change","z":"5469bf4.95d0d4","name":"Change on to \"2\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":760,"wires":[["4bb08002.2e1bd"]]},{"id":"4bb08002.2e1bd","type":"api-call-service","z":"5469bf4.95d0d4","name":"Office Fan on","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"fan","service":"turn_on","entityId":"fan.office_fan","data":"{\"speed\":\"medium\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1120,"y":820,"wires":[["19838dc8.155ad2"]]},{"id":"2e42326f.cc9efe","type":"api-call-service","z":"5469bf4.95d0d4","name":"turn on nightstand","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.shelly_shsw_1_8b0000","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":970,"y":1000,"wires":[[]]},{"id":"fccdf732.822158","type":"api-call-service","z":"5469bf4.95d0d4","name":"turn off nightstand","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.shelly_shsw_1_8b0000","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1170,"y":1140,"wires":[[]]},{"id":"a7e31ceb.317e7","type":"api-call-service","z":"5469bf4.95d0d4","name":"MBR Fan off","server":"29d635fb.a91c9a","version":"1","service_domain":"fan","service":"turn_off","entityId":"fan.master_bedroom_fan","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":950,"y":1120,"wires":[[]]},{"id":"d1d8bb16.1b2228","type":"change","z":"5469bf4.95d0d4","name":"Change on to \"turn_off\"","rules":[{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"turn_off","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":1060,"wires":[["a7e31ceb.317e7"]]},{"id":"a32c33aa.8c32c","type":"api-call-service","z":"5469bf4.95d0d4","name":"Weather report","server":"29d635fb.a91c9a","version":"1","service_domain":"media_player","service":"play_media","entityId":"media_player.office","data":"{\"media_content_id\":\"Alexa.Weather.Play\",\"media_content_type\":\"sequence\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1160,"y":1200,"wires":[["134c9ec4.5d11b1"]]},{"id":"134c9ec4.5d11b1","type":"delay","z":"5469bf4.95d0d4","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1100,"y":1280,"wires":[["653cf1ab.52ccf"]]},{"id":"653cf1ab.52ccf","type":"api-call-service","z":"5469bf4.95d0d4","name":"Calendar today","server":"29d635fb.a91c9a","version":"1","service_domain":"media_player","service":"play_media","entityId":"media_player.office","data":"{\"media_content_id\":\"Alexa.Calendar.PlayToday\",\"media_content_type\":\"sequence\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1260,"y":1280,"wires":[[]]},{"id":"549682d6.0c2b5c","type":"delay","z":"5469bf4.95d0d4","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":940,"y":1180,"wires":[["fccdf732.822158","a32c33aa.8c32c"]]},{"id":"87108f68.efa5c","type":"change","z":"5469bf4.95d0d4","name":"Change to on","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":880,"wires":[["18859996.ef75f6"]]},{"id":"18859996.ef75f6","type":"link out","z":"5469bf4.95d0d4","name":"Out to torch timer","links":["c23b8893.f12d18"],"x":1235,"y":880,"wires":[]},{"id":"b3ac4058.be869","type":"comment","z":"5469bf4.95d0d4","name":"Torch ON","info":"","x":1320,"y":880,"wires":[]},{"id":"f2a3d48.f838328","type":"msg-router","z":"5469bf4.95d0d4","routerType":"broadcast","topicDependent":false,"counterReset":false,"msgKeyField":"payload","undefinedHash":false,"outputsInfo":[{"active":true,"clone":false,"delay":"0","weight":"0"},{"active":true,"clone":false,"delay":"100","weight":"0"},{"active":true,"clone":false,"delay":"100","weight":"0"},{"active":true,"clone":false,"delay":"100","weight":"0"}],"name":"","delaying":"unrelated","msgControl":false,"outputs":4,"x":880,"y":780,"wires":[["8fbe90a2.ec667"],["75aa0f41.70586"],["528fce7d.fa66"],["87108f68.efa5c"]]},{"id":"fff71886.e28088","type":"switch","z":"5469bf4.95d0d4","name":"Is it Time?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":820,"wires":[["f2a3d48.f838328"]]},{"id":"35a2138b.c8fa0c","type":"join","z":"5469bf4.95d0d4","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":610,"y":1020,"wires":[["7ef61369.c8046c"]]},{"id":"7ef61369.c8046c","type":"function","z":"5469bf4.95d0d4","name":"Compare Times","func":"newmsg = {};\nif (msg.payload[0] == msg.payload[1]) {\n    newmsg.payload = \"True\";\n} else {\n    newmsg.payload = \"False\";\n}\n\nreturn newmsg;","outputs":1,"noerr":0,"x":660,"y":1080,"wires":[["592e0078.b5e65"]]},{"id":"bfc441e9.61053","type":"api-current-state","z":"5469bf4.95d0d4","name":"Alarm Clock ON?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_option_alarmclock","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":150,"y":1080,"wires":[[],["ebf92e55.aa3f9","e483eb5.dcae118"]]},{"id":"ebf92e55.aa3f9","type":"api-current-state","z":"5469bf4.95d0d4","name":"Get Alarm Time","server":"29d635fb.a91c9a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_datetime.next_alarm","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":400,"y":1140,"wires":[["9a8e74d7.296eb8"]]},{"id":"e483eb5.dcae118","type":"moment","z":"5469bf4.95d0d4","name":"Current Time","topic":"","input":"payload","inputType":"msg","inTz":"America/New_York","adjAmount":"0","adjType":"minutes","adjDir":"subtract","format":"H:mm","locale":"C","output":"payload","outputType":"msg","outTz":"America/New_York","x":390,"y":1020,"wires":[["35a2138b.c8fa0c"]]},{"id":"ffa7cc34.2db44","type":"inject","z":"5469bf4.95d0d4","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1020,"wires":[["bfc441e9.61053"]]},{"id":"9a8e74d7.296eb8","type":"moment","z":"5469bf4.95d0d4","name":"At alarm time +10","topic":"","input":"payload","inputType":"msg","inTz":"America/New_York","adjAmount":"10","adjType":"minutes","adjDir":"add","format":"H:mm","locale":"C","output":"payload","outputType":"msg","outTz":"America/New_York","x":410,"y":1080,"wires":[["35a2138b.c8fa0c"]]},{"id":"592e0078.b5e65","type":"switch","z":"5469bf4.95d0d4","name":"Is it Time?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":1140,"wires":[["2e42326f.cc9efe","d1d8bb16.1b2228","549682d6.0c2b5c"]]},{"id":"754fb42e.62ad3c","type":"change","z":"5469bf4.95d0d4","name":"make into speech","rules":[{"t":"change","p":"payload","pt":"msg","from":"off","fromt":"str","to":"I have turned off the coffee pot","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"The coffee pot is on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":540,"wires":[["6978064e.1264c8"]]},{"id":"6978064e.1264c8","type":"delay","z":"5469bf4.95d0d4","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":540,"wires":[["66de74f6.6cb2ac"]]},{"id":"66de74f6.6cb2ac","type":"rbe","z":"5469bf4.95d0d4","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":930,"y":540,"wires":[["5e0577e4.ae2668"]]},{"id":"c194819c.a4555","type":"comment","z":"5469bf4.95d0d4","name":"Tell me the Coffee pot status","info":"","x":470,"y":500,"wires":[]},{"id":"6d97b596.4c8f1c","type":"mqtt in","z":"5469bf4.95d0d4","name":"coffee pot status","topic":"CoffeePot/status","qos":"1","datatype":"utf8","broker":"9afb58a1.205718","x":380,"y":540,"wires":[["754fb42e.62ad3c"]]},{"id":"5e0577e4.ae2668","type":"subflow:ecafd5c5.2d8028","z":"5469bf4.95d0d4","name":"","x":1110,"y":540,"wires":[]},{"id":"169bf225.5f941e","type":"api-current-state","z":"5e27b596.12bbbc","name":"Playing?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"media_player.office","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":220,"y":1000,"wires":[["1b3fe99.2a41c16"],["5caf5588.b30abc"]],"outputLabels":["Playing","Paused"]},{"id":"19ea9cf0.060103","type":"inject","z":"5469bf4.95d0d4","name":"","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":430,"y":340,"wires":[["b03cd960.e19478"]]},{"id":"789213c.d1d99ec","type":"change","z":"5469bf4.95d0d4","name":"Change to 'on'","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":420,"wires":[["28060d6a.dda3f2"]]},{"id":"20ece0f6.28122","type":"mqtt out","z":"5e27b596.12bbbc","name":"Coffepot status","topic":"CoffeePot/status","qos":"","retain":"","broker":"9afb58a1.205718","x":1000,"y":540,"wires":[]},{"id":"1f718392.7f3f1c","type":"change","z":"5e27b596.12bbbc","name":"Change to 'off'","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":540,"wires":[["20ece0f6.28122"]]},{"id":"5caf5588.b30abc","type":"function","z":"5e27b596.12bbbc","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":1060,"wires":[["a5f5b8d.2703748","e60d884e.96ec28","bfde9240.121ec"]]},{"id":"e741d05a.e3ead","type":"change","z":"a7b0f219.2da23","name":"Correct names","rules":[{"t":"change","p":"payload","pt":"msg","from":"Garage Opened Smart","fromt":"str","to":"Smart","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Garage Opened 911","fromt":"str","to":"911","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":120,"wires":[["788c304.de25fd"]]},{"id":"35744b7b.9f1d34","type":"subflow:ecafd5c5.2d8028","z":"e1506c1e.a4be5","name":"","x":1060,"y":860,"wires":[]},{"id":"e2b8da45.2336c8","type":"subflow:cba02be5.02efe8","z":"b7987fdf.32542","x":1090,"y":420,"wires":[]},{"id":"c0698bbd.b80db8","type":"subflow:cc5ab19e.7bb6f","z":"b7987fdf.32542","name":"","x":1120,"y":260,"wires":[]},{"id":"240c9366.3cbc5c","type":"bigtimer","z":"b7987fdf.32542","outtopic":"","outpayload1":"","outpayload2":"","name":"Big Timer template","comment":"","lat":"26.017642","lon":"-80.216987","starttime":"360","endtime":"540","starttime2":"5001","endtime2":"1380","startoff":0,"endoff":0,"startoff2":"","endoff2":"","offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":"","month7":"","day8":"","month8":"","day9":"","month9":"","day10":"","month10":"","day11":"","month11":"","day12":"","month12":"","d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":450,"y":660,"wires":[[],[],[]]},{"id":"64202994.fb8698","type":"trigger-state","z":"838b375b.a3fcd8","name":"Laundry button","server":"29d635fb.a91c9a","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.laundry_button","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":110,"y":700,"wires":[["b32d54ff.ba1228"],[]]},{"id":"ff2e8674.a074f8","type":"trigger-state","z":"838b375b.a3fcd8","name":"Laundry room door","server":"29d635fb.a91c9a","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.kitchen_laundry_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":410,"y":940,"wires":[["a7a76e8c.9d0bd"],[]]},{"id":"fccf08b4.cd8e18","type":"subflow:2ab0d9fb.322536","z":"838b375b.a3fcd8","name":"","x":790,"y":900,"wires":[]},{"id":"a7a76e8c.9d0bd","type":"trigger","z":"838b375b.a3fcd8","op1":"first trigger","op2":"second trigger","op1type":"str","op2type":"str","duration":"3","extend":false,"units":"min","reset":"","bytopic":"all","name":"","x":590,"y":940,"wires":[["510d2731.828f58"]]},{"id":"510d2731.828f58","type":"debug","z":"838b375b.a3fcd8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":800,"y":980,"wires":[]},{"id":"42f62d68.330dd4","type":"server-state-changed","z":"838b375b.a3fcd8","name":"Washer text","server":"29d635fb.a91c9a","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_text.washer_running","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":90,"y":160,"wires":[[]]},{"id":"7e9773ba.88381c","type":"subflow:a2de79f8.d4c028","z":"838b375b.a3fcd8","name":"","x":1220,"y":140,"wires":[]},{"id":"20e2bbad.514504","type":"subflow:a2de79f8.d4c028","z":"838b375b.a3fcd8","name":"","x":1140,"y":580,"wires":[]},{"id":"6fb4d0a8.9e511","type":"api-current-state","z":"eac2df63.5cf68","name":"Is Jake home?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"away","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.jake_person","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":200,"y":560,"wires":[["a347d184.99067"],[]],"outputLabels":["Not Home","Home"]},{"id":"86ad3982.16cc58","type":"api-current-state","z":"b7987fdf.32542","name":"Is Jake home?","server":"29d635fb.a91c9a","version":1,"outputs":2,"halt_if":"away","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.jake_person","state_type":"str","state_location":"","override_payload":"none","entity_location":"","override_data":"none","blockInputOverrides":false,"x":640,"y":280,"wires":[["be8b72ff.8fe3b"],[]],"outputLabels":["Not Home","Home"]},{"id":"aaf778d8.8fd388","type":"api-call-service","z":"5e27b596.12bbbc","name":"Play KEXP","server":"29d635fb.a91c9a","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.office","data":"{\"media_content_id\":\"k. e. x. p.\",\"media_content_type\":\"TUNEIN\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":290,"y":1200,"wires":[[]]},{"id":"7be90cce.273fe4","type":"inject","z":"5e27b596.12bbbc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1200,"wires":[["aaf778d8.8fd388"]]},{"id":"29583545.da22aa","type":"inject","z":"5469bf4.95d0d4","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":740,"y":900,"wires":[["f2a3d48.f838328"]]}]